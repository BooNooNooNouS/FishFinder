import{bO as ne,r as d,i as t,j as e,G as ce,bS as ze,bJ as Ue,bK as Ge,as as Ve,B as F,bU as ie,d as He,cs as We,I as Be,b7 as Ke,S as ue,bp as Ye,cD as Je,bP as Qe,Y as Ze,bR as Ce,cw as N,d4 as Ie,bx as Te,du as Xe,bw as $e,dj as et,aD as tt,ab as st,aV as at,ah as it,dm as lt}from"./vendor-DM3YzW4g.js";import{e as I,A as b,p as ot,m as c,b as Pe,U as v,f as rt,h as nt}from"./index-D337eai7.js";import{A as dt}from"./AdminButton-DDvP9DUk.js";import{P as Se}from"./PrimaryActionButton-DY8hz4fh.js";import{u as we,I as Re,S as ct,g as ut,H as pt,h as mt,i as _t,j as bt,k as ht,l as ft,e as xt,R as kt,B as jt,P as yt,O as gt,E as Ct,b as It,m as St,C as Ft}from"./InvenTreeTable-Dtz5z1-X.js";import{I as Ot,D as ae,a as At}from"./InstanceDetail-DA14-H9g.js";import{D as Bt}from"./DetailsBadge-Cu6bSDy9.js";import{D as Tt,N as Pt}from"./NotesPanel-D9Ykw5_S.js";import{P as wt}from"./PageDetail-Dn7pSuNG.js";import{A as Rt}from"./AttachmentPanel-Dh6uocMv.js";import{P as Dt}from"./PanelGroup-CoO7I8l_.js";import{u as P,g as vt,a as De,A as Et,k as Mt}from"./UseForm-TWh6_feP.js";import{u as qt,a as Lt,b as Nt,c as zt,B as Ut,d as Fe}from"./BuildOrderTable-CALNzP7P.js";import{u as oe}from"./UseInstance-DbwM5beB.js";import{u as ve}from"./UseStatusCodes-BmC8lzP_.js";import{B as Gt}from"./BuildAllocatedStockTable-CU8Uq6_v.js";import{a as Ee}from"./BuildLineTable-CKrExHRi.js";import{P as Vt}from"./YesNoButton-DTVLZZ3k.js";import{u as Me}from"./DesktopAppView-DyVa6oYc.js";import{f as Ht}from"./formatters-DcPgPpLg.js";import{d as Wt,e as Kt,f as Yt,u as Jt}from"./UseStockAdjustActions-CeS3J9s3.js";import{T as de,f as qe,P as Le,S as Qt}from"./ColumnRenderers-B1TW1pd2.js";import{A as re}from"./ActionButton-Q09YVtCx.js";import{P as Oe}from"./index-BOcT9Srm.js";import{a as Zt,I as T,S as Xt,n as $t}from"./ThemeContext-Ch4E8_Wm.js";import{P as es}from"./PurchaseOrderTable-CQI4ipIF.js";import{S as Ae}from"./StockItemTable-CIOZiwZe.js";import"./QRCode-C5FiSMEd.js";import"./browser-BJvvAuRs.js";import"./ModelType-B9P_b1nX.js";import"./GenericErrorPage-D_bi0_m-.js";import"./NotFound-DAIe8IKA.js";import"./PermissionDenied-BwuEjXQw.js";import"./PageTitle-vGWzRKl1.js";import"./AttachmentLink-DtsxxBFF.js";import"./PluginSource-BculEAAL.js";import"./RemoteComponent-YA1xDtB_.js";import"./RemoveRowButton-DR_woDmL.js";import"./UseGenerator-CAKBBjbF.js";import"./OrderPartsWizard-C1qAvuat.js";import"./CompanyForms-9FjvHQe4.js";import"./PurchaseOrderForms-Bp86LBUe.js";import"./RowExpansionIcon-BT70cimX.js";function ts({buildId:a,partId:o}){const f=we("build-tests"),r=Me(),{data:x}=ne({queryKey:["build-test-templates",o,a],queryFn:async()=>o?r.get(I(b.part_test_template_list),{params:{part:o,include_inherited:!0,enabled:!0,required:!0}}).then(j=>j.data):[]});d.useEffect(()=>{f.refreshTable()},[x]);const[l,s]=d.useState(0),[p,S]=d.useState(0),m=Wt({partId:o,itemId:l,templateId:p}),E=P({url:I(b.stock_test_result_list),title:t._({id:"VzkBcq"}),fields:m,initialData:{template:p,result:!0},onFormSuccess:()=>f.refreshTable(),successMessage:t._({id:"VivtT0"})}),w=d.useMemo(()=>!x||x.length==0?[]:x.map(j=>({accessor:`test_${j.pk}`,title:j.test_name,sortable:!1,switchable:!0,render:y=>{const n=(y.tests||[]).filter(g=>g.template==j.pk).sort((g,M)=>M.pk-g.pk).shift();if(!n||n.result===void 0)return e.jsxs(ce,{gap:"xs",wrap:"nowrap",justify:"space-between",children:[e.jsx(ze,{color:"lightblue",variant:"filled",children:t._({id:"4bobEy"})}),e.jsx(Ue,{label:t._({id:"VzkBcq"}),children:e.jsx(Ge,{size:"lg",color:"green",variant:"transparent",onClick:g=>{ot(g),s(y.pk),S(j.pk),E.open()},children:e.jsx(Ve,{})})})]});const _=[];return n.value&&_.push(e.jsxs(F,{size:"sm",children:[t._({id:"wMHvYH"}),": ",n.value]},"value")),n.notes&&_.push(e.jsxs(F,{size:"sm",children:[t._({id:"1DBGsz"}),": ",n.notes]},"notes")),n.date&&_.push(e.jsxs(F,{size:"sm",children:[t._({id:"mYGY3B"}),": ",Ht(n.date)]},"date")),n.user_detail&&_.push(e.jsx(vt,{instance:n.user_detail},"user")),e.jsx(de,{value:e.jsx(Vt,{value:n.result}),title:j.test_name,extra:_})}})),[x]),h=d.useMemo(()=>[...[{accessor:"stock",title:t._({id:"gILim+"}),sortable:!0,switchable:!1,render:y=>{if(y.serial)return`# ${y.serial}`;{const O=[];return y.batch&&O.push(e.jsxs(F,{size:"sm",children:[t._({id:"Vea6Aj"}),": ",y.batch]},"batch")),e.jsx(de,{value:e.jsxs(F,{children:[t._({id:"VbWX2u"}),": ",y.quantity]}),title:t._({id:"gILim+"}),extra:O})}}},qe({accessor:"location_detail"})],...w],[w]),R=d.useMemo(()=>[{name:"is_building",label:t._({id:"BE5Q6v"}),description:t._({id:"AO8gAN"})}],[]),k=d.useMemo(()=>[],[]);return e.jsxs(e.Fragment,{children:[E.modal,e.jsx(Re,{url:I(b.stock_item_list),tableState:f,columns:h,props:{params:{part_detail:!0,location_detail:!0,tests:!0,build:a},tableFilters:R,tableActions:k,modelType:c.stockitem}})]})}function ss({build:a,output:o,opened:f,close:r}){return e.jsxs(Je,{position:"bottom",size:"lg",title:e.jsxs(ce,{p:"md",wrap:"nowrap",justify:"space-apart",children:[e.jsx(Xt,{size:"lg",children:t._({id:"XqhL5S"})}),e.jsx(Ce,{h:"lg"}),e.jsx(Le,{part:a.part_detail}),(o==null?void 0:o.serial)&&e.jsxs(F,{size:"sm",children:[t._({id:"AXeJt4"}),": ",o.serial]}),(o==null?void 0:o.batch)&&e.jsxs(F,{size:"sm",children:[t._({id:"Vea6Aj"}),": ",o.batch]}),e.jsx(Ce,{h:"lg"})]}),opened:f,onClose:r,withCloseButton:!0,closeOnEscape:!0,closeOnClickOutside:!0,styles:{header:{width:"100%"},title:{width:"100%"}},children:[e.jsx(Qe,{}),e.jsx(Ze,{p:"md",children:e.jsx(Ee,{build:a,output:o,params:{tracked:!0}})})]})}function as({build:a,refreshBuild:o}){var pe,me,_e,be,he,fe,xe,ke,je;const f=Me(),r=Pe(),x=Zt(),l=we("build-outputs"),s=d.useMemo(()=>a.pk??-1,[a.pk]),p=d.useMemo(()=>a.part??-1,[a.part]),S=ve({modelType:c.build}),{data:m,refetch:E}=ne({queryKey:["buildoutputtests",p,a],queryFn:async()=>{var i;return!p||p<0?[]:(i=a==null?void 0:a.part_detail)!=null&&i.testable?f.get(I(b.part_test_template_list),{params:{part:p,include_inherited:!0,enabled:!0,required:!0}}).then(C=>C.data):[]}}),w=d.useMemo(()=>((m==null?void 0:m.length)??0)>0,[p,m]),{data:h,refetch:R}=ne({queryKey:["trackeditems",s],queryFn:async()=>!s||s<0?[]:f.get(I(b.build_line_list),{params:{build:s,tracked:!0}}).then(i=>i.data)}),k=d.useMemo(()=>((h==null?void 0:h.length)??0)>0,[h]);d.useEffect(()=>{l.refreshTable()},[m,h,k,w]);const j=d.useCallback(i=>(i==null||i.forEach((C,A)=>{const L=[];let ye=0;m==null||m.forEach(D=>{var Q;const B=(Q=C.tests)==null?void 0:Q.filter(U=>U.template==D.pk).sort((U,Z)=>U.pk<Z.pk?1:-1).shift();D!=null&&D.required&&(B!=null&&B.result)&&(ye+=1),L.push({name:D.test_name,result:(B==null?void 0:B.result)??!1})}),i[A].passCount=ye,i[A].results=L;let ge=0;h==null||h.forEach(D=>{var Q,U;let B=0;(U=(Q=D.allocations)==null?void 0:Q.filter(Z=>Z.install_into==C.pk))==null||U.forEach(Z=>{B+=Z.quantity}),B>=D.bom_item_detail.quantity&&(ge+=1)}),i[A].fullyAllocated=ge}),i),[p,s,m,h]),y=qt({build:a,modalId:"add-build-output"}),O=P({url:I(b.build_output_create,s),title:t._({id:"jgrPxc"}),modalId:"add-build-output",fields:y,successMessage:t._({id:"U3Kfc5"}),timeout:1e4,initialData:{batch_code:a.batch,location:a.destination??((pe=a.part_detail)==null?void 0:pe.default_location)},onFormSuccess:()=>{R(),E(),l.refreshTable(!0)}}),[n,_]=d.useState([]),g=Lt({build:a,outputs:n,onFormSuccess:()=>{l.refreshTable(!0),o()}}),M=Nt({build:a,outputs:n,onFormSuccess:()=>{l.refreshTable(!0),o()}}),z=zt({build:a,outputs:n,onFormSuccess:()=>{l.refreshTable(!0),o()}}),le=Kt({create:!1,partId:p,stockItem:n[0],modalId:"edit-build-output"}),X=De({url:b.stock_item_list,pk:(me=n[0])==null?void 0:me.pk,title:t._({id:"yP367G"}),modalId:"edit-build-output",fields:le,table:l}),G=P({url:b.build_order_deallocate,pk:a.pk,title:t._({id:"ZZL0Jx"}),preFormContent:e.jsx(ie,{color:"yellow",icon:e.jsx(He,{}),title:t._({id:"ZZL0Jx"}),children:t._({id:"1s7aZ2"})}),fields:{output:{hidden:!0}},initialData:{output:(_e=n[0])==null?void 0:_e.pk},onFormSuccess:()=>{R()}}),$=Yt({partId:(be=n[0])==null?void 0:be.part,trackable:(fe=(he=n[0])==null?void 0:he.part_detail)==null?void 0:fe.trackable,modalId:"build-output-serialize"}),V=P({url:b.stock_serialize,pk:(xe=n[0])==null?void 0:xe.pk,title:t._({id:"euHSRJ"}),modalId:"build-output-serialize",fields:$,initialData:{quantity:((ke=n[0])==null?void 0:ke.quantity)??1,destination:((je=n[0])==null?void 0:je.location)??a.destination},onFormSuccess:()=>{l.refreshTable(!0),o()}}),u=d.useMemo(()=>[{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"+Jr1e4"}),choiceFunction:ct(c.stockitem)},ut(),pt(),mt(),_t(),bt(),ht(),ft()],[]),H=d.useMemo(()=>({items:l.selectedRecords,model:c.stockitem,refresh:l.refreshTable,filters:{}}),[l.selectedRecords,l.refreshTable]),q=Jt({formProps:H,merge:!1,assign:!1,delete:!1,add:!1,count:!1,remove:!1}),W=d.useMemo(()=>[q.dropdown,e.jsx(re,{tooltip:t._({id:"jNuqfk"}),icon:e.jsx(T,{icon:"success"}),color:"green",disabled:!l.hasSelectedRecords,onClick:()=>{_(l.selectedRecords),g.open()}},"complete-selected-outputs"),e.jsx(re,{tooltip:t._({id:"ps+JBt"}),icon:e.jsx(T,{icon:"delete"}),color:"red",disabled:!l.hasSelectedRecords,onClick:()=>{_(l.selectedRecords),M.open()}},"scrap-selected-outputs"),e.jsx(re,{tooltip:t._({id:"MXiIO4"}),icon:e.jsx(T,{icon:"cancel"}),color:"red",disabled:!l.hasSelectedRecords,onClick:()=>{_(l.selectedRecords),z.open()}},"cancel-selected-outputs"),e.jsx(Et,{tooltip:t._({id:"jgrPxc"}),hidden:a.external||!r.hasAddRole(v.build),onClick:O.open},"add-build-output")],[a,r,l.selectedRecords,l.hasSelectedRecords,q.dropdown]),K=d.useCallback(i=>{var A;const C=(a==null?void 0:a.status)==S.PRODUCTION;return[xt({title:t._({id:"MeORpZ"}),modelId:i.pk,modelType:c.stockitem,navigate:x}),{title:t._({id:"9X8lAk"}),tooltip:t._({id:"kHgU4C"}),color:"blue",hidden:!C||!k||!r.hasChangeRole(v.build),icon:e.jsx(T,{icon:"plus"}),onClick:()=>{_([i]),Y()}},{title:t._({id:"kp5oT9"}),tooltip:t._({id:"NLp8ve"}),color:"red",hidden:!C||!k||!r.hasChangeRole(v.build),icon:e.jsx(T,{icon:"minus"}),onClick:()=>{_([i]),G.open()}},{title:t._({id:"Wlr+mY"}),tooltip:t._({id:"+as741"}),color:"blue",hidden:!((A=i.part_detail)!=null&&A.trackable)||!!i.serial,icon:e.jsx(T,{icon:"serial"}),onClick:()=>{_([i]),V.open()}},{title:t._({id:"bD8I7O"}),tooltip:t._({id:"BdMeIY"}),color:"green",icon:e.jsx(T,{icon:"success"}),onClick:()=>{_([i]),g.open()}},kt({tooltip:t._({id:"yP367G"}),onClick:()=>{_([i]),X.open()}}),{title:t._({id:"5mspUE"}),tooltip:t._({id:"oise/z"}),icon:e.jsx(T,{icon:"delete"}),color:"red",onClick:()=>{_([i]),M.open()}},{title:t._({id:"dEgA5A"}),tooltip:t._({id:"ewDpt2"}),icon:e.jsx(T,{icon:"cancel"}),color:"red",onClick:()=>{_([i]),z.open()}}]},[S,r,p,k]),ee=d.useMemo(()=>[{accessor:"part",sortable:!0,render:i=>Le({part:i==null?void 0:i.part_detail})},{accessor:"quantity",ordering:"stock",sortable:!0,switchable:!1,title:t._({id:"gILim+"}),render:i=>{let C=i.quantity;return i.serial&&(C=`# ${i.serial}`),C}},{accessor:"batch",sortable:!0},Qt({accessor:"status",sortable:!0,model:c.stockitem}),qe({accessor:"location_detail"}),{accessor:"allocations",sortable:!1,switchable:!1,hidden:!k,title:t._({id:"/b62hy"}),render:i=>e.jsx(Oe,{progressLabel:!0,value:i.fullyAllocated??0,maximum:(h==null?void 0:h.length)??0})},{accessor:"tests",sortable:!1,switchable:!1,title:t._({id:"E4lFEY"}),hidden:!w,render:i=>{var A;const C=((A=i.results)==null?void 0:A.map(L=>L&&e.jsxs(ce,{justify:"left",wrap:"nowrap",children:[L.result?e.jsx(Be,{color:"green"}):e.jsx(Ke,{color:"red"}),e.jsx(F,{children:L.name})]},L.name)))??[];return e.jsx(de,{value:e.jsx(Oe,{progressLabel:!0,value:i.passCount??0,maximum:(m==null?void 0:m.length)??0}),extra:C,title:t._({id:"isbwWo"})})}}],[s,p,w,k,m,h]),[te,{open:Y,close:J}]=We(!1),se=d.useCallback(()=>{J(),R()},[J,R]);return e.jsxs(e.Fragment,{children:[O.modal,g.modal,M.modal,X.modal,G.modal,z.modal,V.modal,q.modals.map(i=>i.modal),e.jsx(ss,{build:a,output:n[0],opened:te,close:se}),e.jsxs(ue,{gap:"xs",children:[a.external&&e.jsx(ie,{color:"blue",icon:e.jsx(Ye,{}),title:t._({id:"ckc7Jf"}),children:t._({id:"5pH9Hn"})}),e.jsx(Re,{tableState:l,url:I(b.stock_item_list),columns:ee,props:{params:{part_detail:!0,location_detail:!0,tests:!0,is_building:!0,build:s},enableLabels:!0,enableReports:!0,modelType:c.stockitem,dataFormatter:j,tableFilters:u,tableActions:W,rowActions:K,enableSelection:!0,onRowClick:i=>{k&&i.serial&&(_([i]),Y())}}})]})]})}function Ne(){return e.jsx(ie,{color:"blue",icon:e.jsx(Te,{}),title:t._({id:"RBkcix"}),children:e.jsxs(ue,{gap:"xs",children:[e.jsx(F,{children:t._({id:"bcmsL1"})}),e.jsx(F,{children:t._({id:"qMpNaN"})})]})})}function is({build:a,isLoading:o,hasItems:f}){return o||!a.pk?e.jsx(N,{w:"100%",h:400,animate:!0}):f?e.jsx(Ee,{build:a}):e.jsx(Ne,{})}function ls({build:a,isLoading:o,hasItems:f}){return o||!a.pk?e.jsx(N,{w:"100%",h:400,animate:!0}):f?e.jsx(Gt,{buildId:a.pk,showPartInfo:!0,allowEdit:!0}):e.jsx(Ne,{})}function Js(){var G,$,V;const{id:a}=$t(),o=Pe(),f=rt(),{instance:r,instanceQuery:x}=oe({endpoint:b.build_line_list,params:{build:a,allocations:!1,part_detail:!1,build_detail:!1,bom_item_detail:!1,limit:1},disabled:!a,hasPrimaryKey:!1,defaultValue:{}}),l=ve({modelType:c.build}),{instance:s,refreshInstance:p,instanceQuery:S}=oe({endpoint:b.build_order_list,pk:a,params:{part_detail:!0},refetchOnMount:!0}),{instance:m,instanceQuery:E}=oe({endpoint:b.part_requirements,pk:s==null?void 0:s.part,hasPrimaryKey:!0,defaultValue:{}}),w=d.useMemo(()=>{var ee,te,Y,J,se;if(S.isFetching)return e.jsx(N,{});const u={...s,can_build:(m==null?void 0:m.can_build)??0},H=[{type:"link",name:"part",label:t._({id:"vgP+9p"}),model:c.part},{type:"text",name:"part_detail.IPN",icon:"part",label:t._({id:"3wXEsN"}),hidden:!((ee=s.part_detail)!=null&&ee.IPN),copy:!0},{type:"string",name:"part_detail.revision",icon:"revision",label:t._({id:"6LTyxl"}),hidden:!((te=s.part_detail)!=null&&te.revision),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:c.build},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:c.build,icon:"status",hidden:!s.status_custom_key||s.status_custom_key==s.status},{type:"boolean",name:"external",label:t._({id:"bVhrVt"}),icon:"manufacturers",hidden:!s.external},{type:"text",name:"purchase_order",label:t._({id:"KxySMG"}),icon:"purchase_orders",copy:!0,hidden:!s.external,value_formatter:()=>"TODO: external PO"},{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"title",label:t._({id:"Nu4oKW"}),icon:"description",copy:!0},{type:"link",name:"parent",icon:"builds",label:t._({id:"jqsG41"}),model_field:"reference",model:c.build,hidden:!s.parent}],q=[{type:"number",name:"quantity",label:t._({id:"Ee+3kG"})},{type:"number",name:"can_build",unit:(Y=s.part_detail)==null?void 0:Y.units,label:t._({id:"S/9nwz"}),hidden:E.isFetching},{type:"progressbar",name:"completed",icon:"progress",total:s.quantity,progress:s.completed,label:t._({id:"Mzv4va"})},{type:"link",name:"sales_order",label:t._({id:"LozYBo"}),icon:"sales_orders",model:c.salesorder,model_field:"reference",hidden:!s.sales_order}],W=[{type:"text",name:"issued_by",label:t._({id:"kmUN8p"}),icon:"user",badge:"user",hidden:!s.issued_by},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!s.responsible},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!s.project_code},{type:"link",name:"take_from",icon:"location",model:c.stocklocation,label:t._({id:"/00Ond"}),backup_value:t._({id:"aZD9Yv"})},{type:"link",name:"destination",icon:"location",model:c.stocklocation,label:t._({id:"o35LCI"}),hidden:!s.destination},{type:"text",name:"batch",label:t._({id:"Vea6Aj"}),hidden:!s.batch,copy:!0}],K=[{type:"date",name:"creation_date",label:t._({id:"d+F6q9"}),icon:"calendar",copy:!0,hidden:!s.creation_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!s.start_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),icon:"calendar",copy:!0,hidden:!s.target_date},{type:"date",name:"completion_date",label:t._({id:"qqWcBV"}),icon:"calendar",copy:!0,hidden:!s.completion_date}];return e.jsxs(Ot,{children:[e.jsxs(Ie,{grow:!0,children:[e.jsx(Tt,{appRole:v.part,apiPath:b.part_list,src:((J=s.part_detail)==null?void 0:J.image)??((se=s.part_detail)==null?void 0:se.thumbnail),pk:s.part}),e.jsx(Ie.Col,{span:{base:12,sm:8},children:e.jsx(ae,{fields:H,item:u})})]}),e.jsx(ae,{fields:q,item:u}),e.jsx(ae,{fields:W,item:u}),e.jsx(ae,{fields:K,item:u})]})},[s,S,m,E.isFetching]),h=d.useMemo(()=>{var u;return[{name:"details",label:t._({id:"98Q4bz"}),icon:e.jsx(Te,{}),content:w},{name:"line-items",label:t._({id:"T2s1M7"}),icon:e.jsx(Xe,{}),content:e.jsx(is,{build:s,isLoading:x.isFetching||x.isLoading,hasItems:(r==null?void 0:r.count)>0})},{name:"allocated-stock",label:t._({id:"MD2yP5"}),icon:e.jsx($e,{}),hidden:s.status==l.COMPLETE||s.status==l.CANCELLED||((r==null?void 0:r.count)??0)<=0,content:e.jsx(ls,{build:s,isLoading:x.isFetching||x.isLoading,hasItems:(r==null?void 0:r.count)>0})},{name:"consumed-stock",label:t._({id:"US3GCq"}),icon:e.jsx(et,{}),hidden:((r==null?void 0:r.count)??0)<=0,content:e.jsx(Ae,{allowAdd:!1,tableName:"build-consumed",showLocation:!1,allowReturn:!0,params:{consumed_by:a}})},{name:"incomplete-outputs",label:t._({id:"E9en8O"}),icon:e.jsx(tt,{}),content:s.pk?e.jsx(as,{build:s,refreshBuild:p}):e.jsx(N,{}),hidden:s.status==l.COMPLETE||s.status==l.CANCELLED},{name:"complete-outputs",label:t._({id:"Mzv4va"}),icon:e.jsx(st,{}),content:e.jsx(Ae,{allowAdd:!1,tableName:"completed-build-outputs",params:{build:a,is_building:!1}})},{name:"external-purchase-orders",label:t._({id:"X0hvRl"}),icon:e.jsx(at,{}),content:s.pk?e.jsx(es,{externalBuildId:s.pk}):e.jsx(N,{}),hidden:!o.hasViewRole(v.purchase_order)||!s.external||!f.isSet("BUILDORDER_EXTERNAL_BUILDS")},{name:"child-orders",label:t._({id:"CVlgqS"}),icon:e.jsx(it,{}),content:s.pk?e.jsx(Ut,{parentBuildId:s.pk}):e.jsx(N,{})},{name:"test-results",label:t._({id:"isbwWo"}),icon:e.jsx(lt,{}),hidden:!((u=s.part_detail)!=null&&u.testable),content:s.pk?e.jsx(ts,{buildId:s.pk,partId:s.part}):e.jsx(N,{})},Rt({model_type:c.build,model_id:s.pk}),Pt({model_type:c.build,model_id:s.pk})]},[s,a,o,l,f,x.isFetching,x.isLoading,r]),R=Fe({create:!1,modalId:"edit-build-order"}),k=De({url:b.build_order_list,pk:s.pk,title:t._({id:"B7ynKf"}),modalId:"edit-build-order",fields:R,onFormSuccess:p}),j=d.useMemo(()=>{const u={...s};return delete u.reference,u},[s]),y=Fe({create:!1,modalId:"duplicate-build-order"}),O=P({url:b.build_order_list,title:t._({id:"59jtLx"}),modalId:"duplicate-build-order",fields:y,initialData:j,follow:!0,modelType:c.build}),n=P({url:I(b.build_order_cancel,s.pk),title:t._({id:"MTYJu1"}),onFormSuccess:p,successMessage:t._({id:"H5qWhm"}),preFormWarning:t._({id:"MPFqR0"}),fields:{remove_allocated_stock:{},remove_incomplete_outputs:{}}}),_=P({url:I(b.build_order_hold,s.pk),title:t._({id:"hZIvSn"}),onFormSuccess:p,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),g=P({url:I(b.build_order_issue,s.pk),title:t._({id:"Z4Rl+B"}),onFormSuccess:p,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),M=d.useMemo(()=>{const u=((r==null?void 0:r.count)??0)>0;return{accept_overallocated:{hidden:!u},accept_unallocated:{hidden:!u},accept_incomplete:{}}},[r.count]),z=P({url:I(b.build_order_complete,s.pk),title:t._({id:"Q/TP3B"}),onFormSuccess:p,preFormContent:e.jsx(ie,{color:"green",icon:e.jsx(Be,{}),title:t._({id:"DYITap"})}),successMessage:t._({id:"W7TghJ"}),fields:M}),le=d.useMemo(()=>{const u=o.hasChangeRole(v.build),H=u&&(s.status==l.PENDING||s.status==l.ON_HOLD),q=u&&s.status==l.PRODUCTION,W=u&&(s.status==l.PENDING||s.status==l.PRODUCTION),K=u&&(s.status==l.PENDING||s.status==l.ON_HOLD||s.status==l.PRODUCTION);return[e.jsx(Se,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!H,color:"blue",onClick:g.open}),e.jsx(Se,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!q,color:"green",onClick:z.open}),e.jsx(dt,{model:c.build,id:s.pk}),e.jsx(jt,{model:c.build,pk:s.pk,hash:s==null?void 0:s.barcode_hash}),e.jsx(yt,{modelType:c.build,items:[s.pk],enableReports:!0}),e.jsx(gt,{tooltip:t._({id:"tDgG1Y"}),actions:[Ct({onClick:()=>k.open(),hidden:!u,tooltip:t._({id:"mVeaUg"})}),It({onClick:()=>O.open(),tooltip:t._({id:"oi/3Pq"}),hidden:!o.hasAddRole(v.build)}),St({tooltip:t._({id:"20mLBC"}),hidden:!W,onClick:_.open}),Ft({tooltip:t._({id:"tVJk4q"}),onClick:n.open,hidden:!K})]})]},[a,s,o,l]),X=d.useMemo(()=>S.isFetching?[]:[e.jsx(Mt,{status:s.status_custom_key,type:c.build,options:{size:"lg"}}),e.jsx(Bt,{label:t._({id:"bVhrVt"}),color:"blue",visible:s.external},"external")],[s,S]);return e.jsxs(e.Fragment,{children:[k.modal,O.modal,n.modal,_.modal,g.modal,z.modal,e.jsx(At,{query:S,requiredRole:v.build,children:e.jsxs(ue,{gap:"xs",children:[e.jsx(wt,{title:`${t._({id:"YxwWvi"})}: ${s.reference}`,subtitle:`${s.quantity} x ${(G=s.part_detail)==null?void 0:G.full_name}`,badges:X,editAction:k.open,editEnabled:o.hasChangePermission(c.part),imageUrl:(($=s.part_detail)==null?void 0:$.image)??((V=s.part_detail)==null?void 0:V.thumbnail),breadcrumbs:[{name:t._({id:"3ctapx"}),url:"/manufacturing"}],lastCrumb:[{name:s.reference,url:nt(c.build,s.pk)}],actions:le}),e.jsx(Dt,{pageKey:"build",panels:h,instance:s,reloadInstance:p,model:c.build,id:s.pk})]})})]})}export{Js as default};
//# sourceMappingURL=BuildDetail-x30z_Qkh.js.map
