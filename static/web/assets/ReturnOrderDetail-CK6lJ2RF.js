import{r as o,i as t,j as r,dw as G,cw as X,d4 as W,bx as ee,bW as b,bw as te,S as re}from"./vendor-DM3YzW4g.js";import{b as Y,m as i,A as a,U as d,e as S,f as se}from"./index-D337eai7.js";import{A as ie}from"./AdminButton-DDvP9DUk.js";import{P as B}from"./PrimaryActionButton-DY8hz4fh.js";import{u as ne,S as oe,R as ae,a as le,I as de,B as ce,P as ue,O as me,E as pe,b as _e,m as he,C as be}from"./InvenTreeTable-Dtz5z1-X.js";import{I as ye,D as M,a as xe}from"./InstanceDetail-DA14-H9g.js";import{D as fe,N as ge}from"./NotesPanel-D9Ykw5_S.js";import{n as ke,S as V}from"./ThemeContext-Ch4E8_Wm.js";import{P as Ce}from"./PageDetail-Dn7pSuNG.js";import{A as Re}from"./AttachmentPanel-Dh6uocMv.js";import{P as Se}from"./PanelGroup-CoO7I8l_.js";import{u as x,a as $,b as je,A as Ie,k as Ae}from"./UseForm-TWh6_feP.js";import{b as z}from"./formatters-DcPgPpLg.js";import{a as H,b as Fe,u as Z}from"./ReturnOrderForms-Dp-VvvNE.js";import{u as De}from"./UseInstance-DbwM5beB.js";import{u as J}from"./UseStatusCodes-BmC8lzP_.js";import{E as Pe}from"./ExtraLineItemTable-DdFxjHRm.js";import{A as Ne}from"./ActionButton-Q09YVtCx.js";import{P as Oe,D as Ee,S as K,R as Le,a as Q,N as Me,L as ve}from"./ColumnRenderers-B1TW1pd2.js";import"./DesktopAppView-DyVa6oYc.js";import"./index-BOcT9Srm.js";import"./QRCode-C5FiSMEd.js";import"./browser-BJvvAuRs.js";import"./YesNoButton-DTVLZZ3k.js";import"./ModelType-B9P_b1nX.js";import"./GenericErrorPage-D_bi0_m-.js";import"./NotFound-DAIe8IKA.js";import"./PermissionDenied-BwuEjXQw.js";import"./PageTitle-vGWzRKl1.js";import"./AttachmentLink-DtsxxBFF.js";import"./PluginSource-BculEAAL.js";import"./RemoteComponent-YA1xDtB_.js";import"./RemoveRowButton-DR_woDmL.js";import"./CommonForms-BLD2bvwT.js";function Te({orderId:u,order:m,orderDetailRefresh:y,customerId:e,currency:p}){const n=ne("return-order-line-item"),c=Y(),j=J({modelType:i.returnorder}),[I,A]=o.useState(0),_=o.useMemo(()=>m.status==j.IN_PROGRESS,[m,j]),v=H({orderId:u,customerId:e,create:!0}),f=H({orderId:u,customerId:e}),F=x({url:a.return_order_line_list,title:t._({id:"pwb7Yo"}),fields:v,initialData:{order:u,price_currency:p},onFormSuccess:y,table:n}),g=$({url:a.return_order_line_list,pk:I,title:t._({id:"vgosWS"}),fields:f,onFormSuccess:y,table:n}),k=je({url:a.return_order_line_list,pk:I,title:t._({id:"tpKh8C"}),onFormSuccess:y,table:n}),D=o.useMemo(()=>[{accessor:"part",title:t._({id:"vgP+9p"}),switchable:!1,render:s=>Oe({part:s==null?void 0:s.part_detail})},{accessor:"part_detail.IPN",sortable:!1},Ee({accessor:"part_detail.description"}),{accessor:"item_detail.serial",title:t._({id:"VbWX2u"}),switchable:!1,render:s=>s.item_detail.serial&&s.quantity==1?`# ${s.item_detail.serial}`:s.quantity},K({model:i.stockitem,sortable:!1,accessor:"item_detail.status",title:t._({id:"uAQUqI"})}),Le({}),K({model:i.returnorderlineitem,sortable:!0,accessor:"outcome"}),{accessor:"price",render:s=>z(s.price,{currency:s.price_currency})},Q({accessor:"target_date",title:t._({id:"ZmykKo"})}),Q({accessor:"received_date",title:t._({id:"J18WDZ"})}),Me({accessor:"notes"}),ve({})],[]),P=o.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"qVsPia"})},{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"vQY+8t"}),choiceFunction:oe(i.returnorderlineitem)}],[]),N=o.useMemo(()=>[r.jsx(Ie,{tooltip:t._({id:"pwb7Yo"}),hidden:!c.hasAddRole(d.return_order),onClick:()=>{F.open()}},"add-line-item"),r.jsx(Ne,{tooltip:t._({id:"ORa4sV"}),icon:r.jsx(G,{}),hidden:!_||!c.hasChangeRole(d.return_order),onClick:()=>{O(n.selectedRecords.filter(s=>!s.received_date)),C.open()},disabled:n.selectedRecords.length==0},"receive-items")],[c,_,u,n.selectedRecords]),[l,O]=o.useState([]),C=Fe({orderId:u,items:l,onFormSuccess:s=>n.refreshTable()}),E=o.useCallback(s=>[{hidden:!!(s!=null&&s.received_date)||!_||!c.hasChangeRole(d.return_order),title:t._({id:"7cTlo3"}),icon:r.jsx(G,{}),onClick:()=>{O([s]),C.open()}},ae({hidden:!c.hasChangeRole(d.return_order),onClick:()=>{A(s.pk),g.open()}}),le({hidden:!c.hasDeleteRole(d.return_order),onClick:()=>{A(s.pk),k.open()}})],[c,_]);return r.jsxs(r.Fragment,{children:[F.modal,g.modal,k.modal,C.modal,r.jsx(de,{url:S(a.return_order_line_list),tableState:n,columns:D,props:{params:{order:u,part_detail:!0,item_detail:!0,order_detail:!0},enableSelection:_&&c.hasChangeRole(d.return_order),tableActions:N,tableFilters:P,rowActions:E,modelField:"item",modelType:i.stockitem}})]})}function xt(){var E;const{id:u}=ke(),m=Y(),y=se(),{instance:e,instanceQuery:p,refreshInstance:n}=De({endpoint:a.return_order_list,pk:u,params:{customer_detail:!0}}),c=o.useMemo(()=>{var s;return e.order_currency||((s=e.customer_detail)==null?void 0:s.currency)||y.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,y]),j=o.useMemo(()=>{var L,q,U;if(p.isFetching)return r.jsx(X,{});const s=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:t._({id:"ZVUe1A"}),icon:"customer",copy:!0,hidden:!e.customer_reference},{type:"link",name:"customer",icon:"customers",label:t._({id:"876pfE"}),model:i.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:i.returnorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:i.returnorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],h=[{type:"text",name:"line_items",label:t._({id:"SgduFH"}),icon:"list"},{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>{var R;return(e==null?void 0:e.order_currency)??((R=e==null?void 0:e.customer_detail)==null?void 0:R.currency)}},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>{var R;return z(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)||((R=e==null?void 0:e.customer_detail)==null?void 0:R.currency)})}}],T=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"text",name:"contact_detail.name",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"contact_detail.email",label:t._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!((L=e.contact_detail)!=null&&L.email)},{type:"text",name:"contact_detail.phone",label:t._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!((q=e.contact_detail)!=null&&q.phone)},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}],w=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),icon:"calendar",copy:!0,hidden:!e.creation_date},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!e.start_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),copy:!0,hidden:!e.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:t._({id:"41ha49"}),copy:!0,hidden:!e.complete_date}];return r.jsxs(ye,{children:[r.jsxs(W,{grow:!0,children:[r.jsx(fe,{appRole:d.purchase_order,apiPath:a.company_list,src:(U=e.customer_detail)==null?void 0:U.image,pk:e.customer}),r.jsx(W.Col,{span:{base:12,sm:8},children:r.jsx(M,{fields:s,item:e})})]}),r.jsx(M,{fields:h,item:e}),r.jsx(M,{fields:T,item:e}),r.jsx(M,{fields:w,item:e})]})},[e,p]),I=o.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:r.jsx(ee,{}),content:j},{name:"line-items",label:t._({id:"SgduFH"}),icon:r.jsx(te,{}),content:r.jsxs(b,{multiple:!0,defaultValue:["line-items","extra-items"],children:[r.jsxs(b.Item,{value:"line-items",children:[r.jsx(b.Control,{children:r.jsx(V,{size:"lg",children:t._({id:"SgduFH"})})}),r.jsx(b.Panel,{children:r.jsx(Te,{orderId:e.pk,order:e,orderDetailRefresh:n,customerId:e.customer,currency:c})})]},"lineitems"),r.jsxs(b.Item,{value:"extra-items",children:[r.jsx(b.Control,{children:r.jsx(V,{size:"lg",children:t._({id:"l11DG/"})})}),r.jsx(b.Panel,{children:r.jsx(Pe,{endpoint:a.return_order_extra_line_list,orderId:e.pk,orderDetailRefresh:n,currency:c,role:d.return_order})})]},"extraitems")]})},Re({model_type:i.returnorder,model_id:e.pk}),ge({model_type:i.returnorder,model_id:e.pk})],[e,u,m]),A=o.useMemo(()=>p.isLoading?[]:[r.jsx(Ae,{status:e.status_custom_key,type:i.returnorder,options:{size:"lg"}})],[e,p]),_=Z({}),v=Z({duplicateOrderId:e.pk}),f=$({url:a.return_order_list,pk:e.pk,title:t._({id:"RDcVR0"}),fields:_,onFormSuccess:()=>{n()}}),F=o.useMemo(()=>{const s={...e};return delete s.reference,s},[e]),g=x({url:a.return_order_list,title:t._({id:"mpNlR/"}),fields:v,initialData:F,modelType:i.returnorder,follow:!0}),k=x({url:S(a.return_order_issue,e.pk),title:t._({id:"LUGEsQ"}),onFormSuccess:n,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),D=x({url:S(a.return_order_cancel,e.pk),title:t._({id:"qOAlIV"}),onFormSuccess:n,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),P=x({url:S(a.return_order_hold,e.pk),title:t._({id:"Sd+hNf"}),onFormSuccess:n,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),N=x({url:S(a.return_order_complete,e.pk),title:t._({id:"yDIX54"}),onFormSuccess:n,preFormWarning:t._({id:"DYITap"}),successMessage:t._({id:"W7TghJ"})}),l=J({modelType:i.returnorder}),O=o.useMemo(()=>{const s=m.hasChangeRole(d.return_order),h=s&&(e.status==l.PENDING||e.status==l.ON_HOLD),T=s&&(e.status==l.PENDING||e.status==l.PLACED||e.status==l.IN_PROGRESS),w=s&&(e.status==l.PENDING||e.status==l.IN_PROGRESS||e.status==l.ON_HOLD),L=s&&e.status==l.IN_PROGRESS;return[r.jsx(B,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!h,color:"blue",onClick:()=>k.open()}),r.jsx(B,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!L,color:"green",onClick:()=>N.open()}),r.jsx(ie,{model:i.returnorder,id:e.pk}),r.jsx(ce,{model:i.returnorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),r.jsx(ue,{modelType:i.returnorder,items:[e.pk],enableReports:!0}),r.jsx(me,{tooltip:t._({id:"/IKytX"}),actions:[pe({hidden:!m.hasChangeRole(d.return_order),tooltip:t._({id:"mVeaUg"}),onClick:()=>{f.open()}}),_e({tooltip:t._({id:"oi/3Pq"}),hidden:!m.hasChangeRole(d.return_order),onClick:()=>g.open()}),he({tooltip:t._({id:"20mLBC"}),hidden:!T,onClick:()=>P.open()}),be({tooltip:t._({id:"tVJk4q"}),hidden:!w,onClick:()=>D.open()})]})]},[m,e,l]),C=o.useMemo(()=>{var h;let s=((h=e.customer_detail)==null?void 0:h.name)||"";return e.customer_reference&&(s+=` (${e.customer_reference})`),s},[e]);return r.jsxs(r.Fragment,{children:[f.modal,k.modal,D.modal,P.modal,N.modal,g.modal,r.jsx(xe,{query:p,requiredRole:d.return_order,children:r.jsxs(re,{gap:"xs",children:[r.jsx(Ce,{title:`${t._({id:"Z6ve1w"})}: ${e.reference}`,subtitle:C,imageUrl:(E=e.customer_detail)==null?void 0:E.image,badges:A,actions:O,breadcrumbs:[{name:t._({id:"mUv9U4"}),url:"/sales/"}],lastCrumb:[{name:e.reference,url:`/sales/return-order/${e.pk}`}],editAction:f.open,editEnabled:m.hasChangePermission(i.returnorder)}),r.jsx(Se,{pageKey:"returnorder",panels:I,model:i.returnorder,reloadInstance:p.refetch,instance:e,id:e.pk})]})})]})}export{xt as default};
//# sourceMappingURL=ReturnOrderDetail-CK6lJ2RF.js.map
