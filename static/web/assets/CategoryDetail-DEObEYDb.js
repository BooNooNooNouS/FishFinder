import{r as i,j as e,c0 as E,i as a,S as W,bP as ie,bK as ne,b7 as oe,G as v,c5 as le,bO as ce,d7 as de,bJ as ue,b1 as me,cw as pe,B as fe,bx as be,ah as _e,d8 as xe,b9 as he,bv as je,bT as ge}from"./vendor-DM3YzW4g.js";import{b as N,A as j,U as T,e as M,p as ye,h as D,m as h,n as ke}from"./index-D337eai7.js";import{A as Ce}from"./AdminButton-DDvP9DUk.js";import{S as Fe}from"./StarredToggleButton-xSnshv99.js";import{I as Pe,D as L,a as ve}from"./InstanceDetail-DA14-H9g.js";import{u as Y,I as H,A as Te,R as Ie,O as Se,E as we,D as Ae}from"./InvenTreeTable-Dtz5z1-X.js";import{u as z,a as $,f as Re,c as R,d as Me,A as De,b as Oe}from"./UseForm-TWh6_feP.js";import{N as Ee}from"./NavigationTree-BckOClxH.js";import{P as Ne}from"./PageDetail-Dn7pSuNG.js";import{P as $e}from"./PanelGroup-CoO7I8l_.js";import{u as Ke,p as O,P as Be}from"./PartTable-ChX5Vxac.js";import{u as Ve}from"./UseInstance-DbwM5beB.js";import{Y as J}from"./YesNoButton-DTVLZZ3k.js";import{u as Ge}from"./DesktopAppView-DyVa6oYc.js";import{P as Ue,D as X,T as qe}from"./ColumnRenderers-B1TW1pd2.js";import{a as ee,I as Q,n as Le}from"./ThemeContext-Ch4E8_Wm.js";import{S as Qe}from"./StockItemTable-CIOZiwZe.js";import"./ActionButton-Q09YVtCx.js";import"./index-BOcT9Srm.js";import"./formatters-DcPgPpLg.js";import"./ModelType-B9P_b1nX.js";import"./GenericErrorPage-D_bi0_m-.js";import"./NotFound-DAIe8IKA.js";import"./PermissionDenied-BwuEjXQw.js";import"./QRCode-C5FiSMEd.js";import"./browser-BJvvAuRs.js";import"./PageTitle-vGWzRKl1.js";import"./PluginSource-BculEAAL.js";import"./RemoteComponent-YA1xDtB_.js";import"./OrderPartsWizard-C1qAvuat.js";import"./CompanyForms-9FjvHQe4.js";import"./PurchaseOrderForms-Bp86LBUe.js";import"./RemoveRowButton-DR_woDmL.js";import"./UseGenerator-CAKBBjbF.js";import"./UseStockAdjustActions-CeS3J9s3.js";const te={"=":"",">":"_gt",">=":"_gte","<":"_lt","<=":"_lte","!=":"_ne","~":"_icontains"};function K({props:r,operator:s}){return e.jsx(ne,{"aria-label":`clear-filter-${r.template.name}`,variant:"transparent",color:"red",size:"sm",onClick:()=>{r.clearFilter(r.template.pk,s??""),r.closeFilter()},children:e.jsx(oe,{})})}function Ze(r){const s=i.useMemo(()=>r.filters["="]??"",[r.filters]);return e.jsx(E,{"aria-label":`filter-${r.template.name}`,data:[{value:"true",label:a._({id:"c+xCSz"})},{value:"false",label:a._({id:"ocUvR+"})}],value:s,defaultValue:s,onChange:o=>r.setFilter(r.template.pk,o??"","="),placeholder:a._({id:"jf/x3i"}),rightSection:e.jsx(K,{props:r})})}function We(r){const s=i.useMemo(()=>r.filters["="]??"",[r.filters]);return e.jsx(E,{"aria-label":`filter-${r.template.name}`,data:r.template.choices.split(",").map(o=>o.trim()),value:s,defaultValue:s,onChange:o=>r.setFilter(r.template.pk,o??"","="),placeholder:a._({id:"jf/x3i"}),searchable:!0,rightSection:e.jsx(K,{props:r})})}function Z({props:r,value:s,operator:o,readonly:x}){const g=i.useMemo(()=>{let l=a._({id:"0AYT5C"});return r.template.units&&(l+=` [${r.template.units}]`),l},[r.template.units]),[d,t]=i.useState(o);return i.useEffect(()=>{t(o)},[o]),e.jsxs(v,{gap:"xs",wrap:"nowrap",children:[e.jsx("div",{onMouseDown:l=>l.stopPropagation(),style:{width:75},children:e.jsx(E,{onClick:l=>{l==null||l.stopPropagation()},"aria-label":`filter-${r.template.name}-operator`,data:Object.keys(te),value:d,searchable:!1,clearable:!1,defaultValue:"=",onChange:l=>{t(l??"=")},size:"sm",disabled:x,width:75})}),e.jsx(le,{"aria-label":`filter-${r.template.name}`,placeholder:g,defaultValue:s,onKeyDown:l=>{l.key==="Enter"&&(r.setFilter(r.template.pk,l.currentTarget.value||"",d),r.closeFilter())},rightSection:x&&e.jsx(K,{props:r,operator:d})})]})}function Ye(r){return e.jsxs(W,{gap:"xs",children:[Object.keys(r.filters).map(s=>e.jsx(Z,{props:r,value:r.filters[s]??"",operator:s,readonly:!0})),e.jsx(ie,{}),e.jsx(Z,{props:r,value:"",operator:"="})]})}function He(r){return i.useMemo(()=>r.template.checkbox?e.jsx(Ze,{...r}):r.template.choices?e.jsx(We,{...r}):e.jsx(Ye,{...r}),[r])}function ze({record:r,template:s,canEdit:o}){const{hovered:x,ref:g}=de(),d=i.useMemo(()=>{var f;return(f=r.parameters)==null?void 0:f.find(F=>F.template==s.pk)},[r.parameters,s]),t=[],l=i.useMemo(()=>{let f=d==null?void 0:d.data;return s!=null&&s.checkbox&&f!=null&&(f=e.jsx(J,{value:d.data})),f},[d,s]);if(s.units&&d&&d.data_numeric&&d.data_numeric!=d.data){const f=Re(d.data_numeric,{digits:15});t.push(`${f} [${s.units}]`)}return x&&o&&t.push(a._({id:"cwMTjO"})),e.jsx("div",{children:e.jsx(v,{grow:!0,ref:g,justify:"space-between",children:e.jsx(v,{grow:!0,children:e.jsx(qe,{value:l??"-",extra:t,icon:x&&o?"edit":"info",title:s.name})})})})}function Je({categoryId:r}){const s=Ge(),o=Y("parametric-parts"),x=N(),g=ee(),d=ce({queryKey:["category-parameters",r],queryFn:async()=>s.get(M(j.part_parameter_template_list),{params:{category:r}}).then(u=>u.data),refetchOnMount:!0}),[t,l]=i.useState({}),f=i.useCallback((u,n)=>{const m=`parameter_${u}`;if(!n){l(c=>{const p={...c};return Object.keys(p).forEach(b=>{b==m&&delete p[b]}),p});return}l(c=>{const p={...c},b=p[m]||{};return b[n]&&delete b[n],{...p,[m]:b}}),o.refreshTable()},[l,o.refreshTable]),F=i.useCallback((u,n,m)=>{const c=`parameter_${u}`;l(p=>{const b={...p},A=b[c]||{};return A[m]=n,{...b,[c]:A}}),o.refreshTable()},[l,f,o.refreshTable]),k=i.useMemo(()=>{const u={};return Object.keys(t).forEach(n=>{const m=t[n];Object.keys(m).forEach(c=>{const p=`${n}${te[c]||""}`,b=m[c];u[p]=b})}),u},[t]),[y,I]=i.useState(0),[w,_]=i.useState(0),[P,C]=i.useState(0),S=Ke({editTemplate:!1}),B=z({url:j.part_parameter_list,title:a._({id:"iwRvX8"}),fields:i.useMemo(()=>({...S}),[S]),focus:"data",onFormSuccess:u=>{G(y,u)},initialData:{part:y,template:w}}),V=$({url:j.part_parameter_list,title:a._({id:"ZqLOh/"}),pk:P,fields:i.useMemo(()=>({...S}),[S]),focus:"data",onFormSuccess:u=>{G(y,u)}}),G=i.useCallback((u,n)=>{const m=o.records,c=m.findIndex(b=>b.pk==u);if(c<0){o.refreshTable();return}const p=m[c].parameters.findIndex(b=>b.pk==n.pk);p<0?m[c].parameters.push(n):m[c].parameters[p]=n,o.updateRecord(m[c])},[o.updateRecord]),U=i.useMemo(()=>((d==null?void 0:d.data)||[]).map(n=>{let m=n.name;n.units&&(m+=` [${n.units}]`);const c=t[`parameter_${n.pk}`]||{};return{accessor:`parameter_${n.pk}`,title:m,sortable:!0,extra:{template:n.pk},render:p=>e.jsx(ze,{record:p,template:n,canEdit:x.hasChangeRole(T.part)}),filtering:Object.keys(c).length>0,filter:({close:p})=>e.jsx(He,{template:n,filters:t[`parameter_${n.pk}`]||{},setFilter:F,clearFilter:f,closeFilter:p})}}),[x,d.data,t]),ae=i.useCallback((u,n)=>{var c;_(u),I(n.pk);const m=(c=n.parameters)==null?void 0:c.find(p=>p.template==u);m?(C(m.pk),V.open()):B.open()},[]),re=i.useMemo(()=>[{name:"active",label:a._({id:"F6pfE9"}),description:a._({id:"xqUGVc"})},{name:"locked",label:a._({id:"G2fuEb"}),description:a._({id:"tB/dWJ"})},{name:"assembly",label:a._({id:"WL36Yh"}),description:a._({id:"IxF0Eq"})}],[]),se=i.useMemo(()=>[...[{accessor:"name",title:a._({id:"vgP+9p"}),sortable:!0,switchable:!1,noWrap:!0,render:n=>Ue({part:n})},X({defaultVisible:!1}),{accessor:"IPN",sortable:!0,defaultVisible:!1},{accessor:"total_in_stock",sortable:!0}],...U],[U]);return e.jsxs(e.Fragment,{children:[B.modal,V.modal,e.jsx(H,{url:M(j.part_list),tableState:o,columns:se,props:{enableDownload:!0,tableFilters:re,params:{category:r,cascade:!0,category_detail:!0,parameters:!0,...k},onCellClick:({event:u,record:n,index:m,column:c,columnIndex:p})=>{var b,A;if(ye(u),(A=(b=c==null?void 0:c.accessor)==null?void 0:b.toString())!=null&&A.startsWith("parameter_"))ae(c.extra.template,n);else if(n!=null&&n.pk){const q=D(h.part,n.pk);ke(q,g,u)}}}})]})}function Xe({parentId:r}){const s=Y("partcategory"),o=N(),x=i.useMemo(()=>[{accessor:"name",sortable:!0,switchable:!1,render:_=>e.jsxs(v,{gap:"xs",wrap:"nowrap",justify:"space-between",children:[e.jsxs(v,{gap:"xs",wrap:"nowrap",children:[_.icon&&e.jsx(R,{name:_.icon}),_.name]}),e.jsx(v,{gap:"xs",justify:"flex-end",wrap:"nowrap",children:_.starred&&e.jsx(ue,{label:a._({id:"mUyvRx"}),children:e.jsx(me,{color:"green",size:16})})})]})},X({}),{accessor:"pathstring",sortable:!1},{accessor:"structural",sortable:!0,defaultVisible:!1,render:_=>e.jsx(J,{value:_.structural})},{accessor:"part_count",sortable:!0}],[]),g=i.useMemo(()=>[{name:"cascade",label:a._({id:"NgZniC"}),description:a._({id:"Tt3/Pp"})},{name:"structural",label:a._({id:"PRKZBP"}),description:a._({id:"kHkg2b"})},{name:"starred",label:a._({id:"7VIaU3"}),description:a._({id:"mcDc03"})}],[]),d=O({create:!0}),t=z({url:j.category_list,title:a._({id:"sIMwJx"}),fields:d,focus:"name",initialData:{parent:r},follow:!0,modelType:h.partcategory,table:s}),[l,f]=i.useState(-1),F=O({create:!1}),k=$({url:j.category_list,pk:l,title:a._({id:"7fjpj0"}),fields:F,onFormSuccess:_=>s.updateRecord(_)}),y=Me({url:j.category_list,items:s.selectedIds,title:a._({id:"H52WlQ"}),fields:{parent:{}},onFormSuccess:s.refreshTable}),I=i.useMemo(()=>{const _=o.hasAddRole(T.part_category),P=o.hasChangeRole(T.part_category);return[e.jsx(Te,{tooltip:a._({id:"O/o81A"}),icon:e.jsx(Q,{icon:"category"}),disabled:!s.hasSelectedRecords,actions:[{name:a._({id:"OORNPU"}),icon:e.jsx(Q,{icon:"category"}),tooltip:a._({id:"rB20aK"}),hidden:!P,disabled:!s.hasSelectedRecords,onClick:()=>{y.open()}}]}),e.jsx(De,{tooltip:a._({id:"5LuNgu"}),onClick:()=>t.open(),hidden:!_},"add-part-category")]},[o,s.hasSelectedRecords]),w=i.useCallback(_=>{const P=o.hasChangeRole(T.part_category);return[Ie({hidden:!P,onClick:()=>{f(_.pk),k.open()}})]},[o]);return e.jsxs(e.Fragment,{children:[t.modal,k.modal,y.modal,e.jsx(H,{url:M(j.category_list),tableState:s,columns:x,props:{enableDownload:!0,enableSelection:!0,params:{parent:r,top_level:r===void 0?!0:void 0},tableFilters:g,tableActions:I,rowActions:w,modelType:h.partcategory}})]})}function Ot(){const{id:r}=Le(),s=i.useMemo(()=>Number.isNaN(Number.parseInt(r||""))?void 0:r,[r]),o=ee(),x=N(),[g,d]=i.useState(!1),{instance:t,refreshInstance:l,instanceQuery:f}=Ve({endpoint:j.category_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),F=i.useMemo(()=>{if(s&&f.isFetching)return e.jsx(pe,{});const C=[{type:"text",name:"name",label:a._({id:"6YtxFj"}),copy:!0,value_formatter:()=>e.jsxs(v,{gap:"xs",children:[t.icon&&e.jsx(R,{name:t.icon}),t.name]})},{type:"text",name:"pathstring",label:a._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:a._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:a._({id:"o8hZ41"}),model:h.partcategory,hidden:!(t!=null&&t.parent)},{type:"boolean",name:"starred",icon:"notification",label:a._({id:"7VIaU3"})}],S=[{type:"text",name:"part_count",label:a._({id:"pmRbKZ"}),icon:"part",value_formatter:()=>(t==null?void 0:t.part_count)||"0"},{type:"text",name:"subcategories",label:a._({id:"7lonqg"}),icon:"sitemap",hidden:!(t!=null&&t.subcategories)},{type:"boolean",name:"structural",label:a._({id:"PRKZBP"}),icon:"sitemap"},{type:"link",name:"parent_default_location",label:a._({id:"XLVNTv"}),model:h.stocklocation,hidden:!t.parent_default_location||t.default_location},{type:"link",name:"default_location",label:a._({id:"QC5Msb"}),model:h.stocklocation,hidden:!t.default_location}];return e.jsxs(Pe,{children:[s&&(t!=null&&t.pk)?e.jsx(L,{item:t,fields:C}):e.jsx(fe,{children:a._({id:"PFKWrQ"})}),s&&(t==null?void 0:t.pk)&&e.jsx(L,{item:t,fields:S})]})},[t,f]),k=$({url:j.category_list,pk:s,title:a._({id:"7fjpj0"}),fields:O({}),onFormSuccess:l}),y=i.useMemo(()=>[{value:0,display_name:a._({id:"y6iD6w"})},{value:1,display_name:a._({id:"lzGbCT"})}],[]),I=Oe({url:j.category_list,pk:s,title:a._({id:"2tjyh5"}),fields:{delete_parts:{label:a._({id:"PJYQQn"}),description:a._({id:"ZqK0DP"}),choices:y,field_type:"choice"},delete_child_categories:{label:a._({id:"QgH9YK"}),description:a._({id:"ISGGrw"}),choices:y,field_type:"choice"}},onFormSuccess:()=>{t.parent?o(D(h.partcategory,t.parent)):o("/part/")}}),w=i.useMemo(()=>[e.jsx(Ce,{model:h.partcategory,id:t.pk},"admin"),e.jsx(Fe,{instance:t,model:h.partcategory,successFunction:()=>{l()}},"starred_change"),e.jsx(Se,{tooltip:a._({id:"O/o81A"}),actions:[we({hidden:!s||!x.hasChangeRole(T.part_category),tooltip:a._({id:"7fjpj0"}),onClick:()=>k.open()}),Ae({hidden:!s||!x.hasDeleteRole(T.part_category),tooltip:a._({id:"2tjyh5"}),onClick:()=>I.open()})]},"category-actions")],[s,x,t.pk,t.starred]),_=i.useMemo(()=>[{name:"details",label:a._({id:"wp9B4i"}),icon:e.jsx(be,{}),content:F},{name:"subcategories",label:a._({id:"7lonqg"}),icon:e.jsx(_e,{}),content:e.jsx(Xe,{parentId:s})},{name:"parts",label:a._({id:"pmRbKZ"}),icon:e.jsx(xe,{}),content:e.jsx(Be,{props:{params:{category:s}}})},{name:"stockitem",label:a._({id:"Jbck4N"}),icon:e.jsx(he,{}),hidden:!s,content:e.jsx(Qe,{params:{category:s},allowAdd:!1,tableName:"category-stockitems"})},{name:"parameters",label:a._({id:"TxrNvj"}),icon:e.jsx(je,{}),content:e.jsx(Je,{categoryId:s})}],[t,s]),P=i.useMemo(()=>[{name:a._({id:"pmRbKZ"}),url:"/part"},...(t.path??[]).map(C=>({name:C.name,url:D(h.partcategory,C.pk),icon:C.icon?e.jsx(R,{name:C.icon}):void 0}))],[t]);return e.jsxs(e.Fragment,{children:[k.modal,I.modal,e.jsx(ve,{query:f,requiredRole:T.part_category,children:e.jsxs(W,{gap:"xs",children:[e.jsx(ge,{visible:f.isFetching}),e.jsx(Ee,{modelType:h.partcategory,title:a._({id:"2GkbLI"}),endpoint:j.category_tree,opened:g,onClose:()=>{d(!1)},selectedId:t==null?void 0:t.pk}),e.jsx(Ne,{title:(t==null?void 0:t.name)??a._({id:"QXANxH"}),subtitle:t==null?void 0:t.description,icon:(t==null?void 0:t.icon)&&e.jsx(R,{name:t==null?void 0:t.icon}),breadcrumbs:P,breadcrumbAction:()=>{d(!0)},actions:w,editAction:k.open,editEnabled:!!(t!=null&&t.pk)&&x.hasChangePermission(h.partcategory)}),e.jsx($e,{pageKey:"partcategory",panels:_,model:h.partcategory,instance:t,reloadInstance:l,id:t.pk??null})]})})]})}export{Ot as default};
//# sourceMappingURL=CategoryDetail-DEObEYDb.js.map
