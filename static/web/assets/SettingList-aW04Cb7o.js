import{j as l,G as t,S as M,B as h,c7 as L,i as f,cu as G,Y as q,r as c,H as k,by as $,bR as F,ed as V,n as v,bU as B,d as N,cw as D,db as H,A as K,f2 as T}from"./vendor-DM3YzW4g.js";import{b as W,v as C,m as J,M as X,a as Y,e as P,f as O,o as Q,J as z,A,K as Z}from"./index-D337eai7.js";import{a as g,S as ee,k as le}from"./ThemeContext-Ch4E8_Wm.js";import{u as ae}from"./DesktopAppView-DyVa6oYc.js";import{R as re,a as se}from"./UseForm-TWh6_feP.js";function fe({label:e,title:s,shorthand:r,subtitle:i}){const d=W(),u=g();return l.jsxs(t,{justify:"space-between",children:[l.jsxs(M,{gap:"0",ml:"sm",children:[l.jsxs(t,{children:[l.jsx(ee,{size:"xl",children:s}),r&&l.jsxs(h,{c:"dimmed",children:["(",r,")"]})]}),l.jsx(t,{children:i?l.jsx(h,{c:"dimmed",children:i}):null})]}),d.isStaff()&&l.jsx(L,{data:[{value:"user",label:f._({id:"ekfzWq"})},{value:"system",label:f._({id:"zNkWa6"})},{value:"admin",label:f._({id:"uTLn08"})}],onChange:a=>u(`/settings/${a}`),value:e})]})}function ie({setting:e,onEdit:s,onToggle:r}){const i=c.useMemo(()=>{var p;let n=e.value;if(e!=null&&e.choices&&((p=e==null?void 0:e.choices)==null?void 0:p.length)>0){const x=e.choices.find(S=>S.value==e.value);n=(x==null?void 0:x.display_name)||e.value}return e!=null&&e.units&&(n=`${n} ${e.units}`),n},[e]),[d,u]=c.useState(null),a=c.useCallback(()=>{e.read_only||s(e)},[e,s]),_=c.useCallback(n=>{e.read_only||r(e,n.currentTarget.checked)},[e,r]),m=c.useMemo(()=>{if(e.model_name){const n=e.model_name.split(".")[1];return J[n]||null}return null},[e]);if(c.useEffect(()=>{if(u(null),m&&e.value){const n=X[m].api_endpoint;Y.get(P(n,e.value)).then(p=>{p.data?u(p.data):u(null)}).catch(p=>{u(null)})}},[e,m]),d&&m&&e.value)return l.jsxs(t,{justify:"right",gap:"xs",children:[l.jsx(re,{instance:d,model:m}),l.jsx(k,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:a,children:l.jsx($,{})})]});switch((e==null?void 0:e.type)||"string"){case"boolean":return l.jsx(V,{size:"sm",radius:"lg","aria-label":`toggle-setting-${e.key}`,disabled:e.read_only,checked:e.value.toLowerCase()=="true",onChange:_,style:{paddingRight:"20px"}});default:return i?l.jsxs(t,{gap:"xs",justify:"right",children:[l.jsx(F,{}),l.jsx(k,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:a,children:i})]}):l.jsx(k,{"aria-label":`edit-setting-${e.key}`,variant:"subtle",disabled:e.read_only,onClick:a,children:l.jsx($,{})})}}function ce({setting:e,shaded:s,onEdit:r,onToggle:i}){const{colorScheme:d}=G(),u={paddingLeft:"8px"};return s&&(u.backgroundColor=d==="light"?C.colors.gray[1]:C.colors.gray[9]),l.jsx(q,{style:u,children:l.jsxs(t,{justify:"space-between",p:"3",children:[l.jsxs(M,{gap:"2",p:"4px",children:[l.jsxs(h,{children:[e.name,e.required?" *":""]}),l.jsx(h,{size:"xs",children:e.description})]}),l.jsx(le,{label:`setting-value-${e.key}`,children:l.jsx(ie,{setting:e,onEdit:r,onToggle:i})})]})})}function b({settingsState:e,keys:s,onChange:r,onLoaded:i}){var U,E,w;c.useEffect(()=>{e.loaded&&(i==null||i(e))},[e.loaded,e.settings]);const d=ae(),u=c.useMemo(()=>{var o;return((o=e==null?void 0:e.settings)==null?void 0:o.map(j=>j.key))??[]},[e==null?void 0:e.settings]),[a,_]=c.useState(void 0),m=c.useMemo(()=>{var o;return(o=a==null?void 0:a.choices)!=null&&o.length?"choice":(a==null?void 0:a.type)!=null?a.type:"string"},[a]),n=c.useMemo(()=>(a==null?void 0:a.key)??"",[a]),p=se({url:e.endpoint,pk:n,pathParams:e.pathParams,title:f._({id:"mjN1LS"}),fields:{value:{field_type:m,required:(a==null?void 0:a.required)??!1,label:a==null?void 0:a.name,description:a==null?void 0:a.description,api_url:(a==null?void 0:a.api_url)??"",model:((U=a==null?void 0:a.model_name)==null?void 0:U.split(".")[1])??null,filters:(a==null?void 0:a.model_filters)||void 0,choices:(a==null?void 0:a.choices)??void 0}},successMessage:f._({id:"1onc6y",values:{key:n}}),onFormSuccess:()=>{e.fetchSettings(),r==null||r()}}),x=c.useCallback(o=>{_(o),p.open()},[p]),S=c.useCallback((o,j)=>{d.patch(P(e.endpoint,o.key,e.pathParams),{value:j}).then(()=>{v.hide("setting"),v.show({title:f._({id:"C3htzi"}),message:f._({id:"n/n6vh",values:{0:o.key}}),color:"green",id:"setting"}),r==null||r()}).catch(y=>{v.hide("setting"),v.show({title:f._({id:"CsUgn+"}),message:y.message,color:"red",id:"setting"})}).finally(()=>{e.fetchSettings()})},[e]);return e.isError?l.jsx(B,{color:"red",icon:l.jsx(N,{}),title:f._({id:"SlfejT"}),children:l.jsx(h,{children:f._({id:"wXadfA"})})}):e!=null&&e.loaded?l.jsxs(l.Fragment,{children:[p.modal,l.jsxs(M,{gap:"xs",children:[(E=s||u)==null?void 0:E.map((o,j)=>{var R;const y=(R=e==null?void 0:e.settings)==null?void 0:R.find(I=>I.key===o);return e!=null&&e.settings&&!y&&console.error(`Setting ${o} not found`),l.jsx(H.Fragment,{children:y?l.jsx(ce,{setting:y,shaded:j%2===0,onEdit:x,onToggle:S}):l.jsxs(h,{size:"sm",style:{fontStyle:"italic"},c:"red",children:["Setting ",o," not found"]})},o)}),((w=s||u)==null?void 0:w.length)===0&&l.jsx(h,{style:{fontStyle:"italic"},children:l.jsx(K,{id:"3CUVvD"})})]})]}):l.jsx(D,{animate:!0})}function me({keys:e}){const s=Q();return l.jsx(b,{settingsState:s,keys:e})}function he({keys:e}){const s=O();return l.jsx(b,{settingsState:s,keys:e})}function te({pluginKey:e,onLoaded:s}){const r=c.useRef(z({plugin:e,endpoint:A.plugin_setting_list})).current,i=T(r);return l.jsx(b,{settingsState:i,onLoaded:s})}function xe({pluginKey:e,onLoaded:s}){const r=c.useRef(z({plugin:e,endpoint:A.plugin_user_setting_list})).current,i=T(r);return l.jsx(b,{settingsState:i,onLoaded:s})}function je({machinePk:e,configType:s,onChange:r}){const i=c.useRef(Z({machine:e,configType:s})).current,d=T(i);return l.jsx(b,{settingsState:d,onChange:r})}export{he as G,je as M,te as P,fe as S,me as U,xe as a};
//# sourceMappingURL=SettingList-aW04Cb7o.js.map
