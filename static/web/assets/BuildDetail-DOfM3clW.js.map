{"version":3,"file":"BuildDetail-DOfM3clW.js","sources":["../../../../../../frontend/src/tables/build/BuildOrderTestTable.tsx","../../../../../../frontend/src/tables/build/BuildOutputTable.tsx","../../../../../../frontend/src/pages/build/BuildDetail.tsx"],"sourcesContent":["import { t } from '@lingui/core/macro';\nimport { ActionIcon, Badge, Group, Text, Tooltip } from '@mantine/core';\nimport { IconCirclePlus } from '@tabler/icons-react';\nimport { useQuery } from '@tanstack/react-query';\nimport { type ReactNode, useEffect, useMemo, useState } from 'react';\n\nimport { PassFailButton } from '@lib/components/YesNoButton';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { apiUrl } from '@lib/functions/Api';\nimport { cancelEvent } from '@lib/functions/Events';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { ApiFormFieldSet } from '@lib/types/Forms';\nimport type { TableColumn } from '@lib/types/Tables';\nimport { RenderUser } from '../../components/render/User';\nimport { useApi } from '../../contexts/ApiContext';\nimport { formatDate } from '../../defaults/formatters';\nimport { useTestResultFields } from '../../forms/StockForms';\nimport { useCreateApiFormModal } from '../../hooks/UseForm';\nimport { useTable } from '../../hooks/UseTable';\nimport { LocationColumn } from '../ColumnRenderers';\nimport { InvenTreeTable } from '../InvenTreeTable';\nimport { TableHoverCard } from '../TableHoverCard';\n\n/**\n * A table which displays all \"test results\" for the outputs generated by a build order.\n */\nexport default function BuildOrderTestTable({\n  buildId,\n  partId\n}: Readonly<{\n  buildId: number;\n  partId: number;\n}>) {\n  const table = useTable('build-tests');\n  const api = useApi();\n\n  // Fetch the test templates required for this build order\n  const { data: testTemplates } = useQuery({\n    queryKey: ['build-test-templates', partId, buildId],\n    queryFn: async () => {\n      if (!partId) {\n        return [];\n      }\n\n      return api\n        .get(apiUrl(ApiEndpoints.part_test_template_list), {\n          params: {\n            part: partId,\n            include_inherited: true,\n            enabled: true,\n            required: true\n          }\n        })\n        .then((res) => res.data);\n    }\n  });\n\n  // Reload the table data whenever the set of templates changes\n  useEffect(() => {\n    table.refreshTable();\n  }, [testTemplates]);\n\n  const [selectedOutput, setSelectedOutput] = useState<number>(0);\n  const [selectedTemplate, setSelectedTemplate] = useState<number>(0);\n\n  const testResultFields: ApiFormFieldSet = useTestResultFields({\n    partId: partId,\n    itemId: selectedOutput,\n    templateId: selectedTemplate\n  });\n\n  const createTestResult = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.stock_test_result_list),\n    title: t`Add Test Result`,\n    fields: testResultFields,\n    initialData: {\n      template: selectedTemplate,\n      result: true\n    },\n    onFormSuccess: () => table.refreshTable(),\n    successMessage: t`Test result added`\n  });\n\n  // Generate a table column for each test template\n  const testColumns: TableColumn[] = useMemo(() => {\n    if (!testTemplates || testTemplates.length == 0) {\n      return [];\n    }\n\n    return testTemplates.map((template: any) => {\n      return {\n        accessor: `test_${template.pk}`,\n        title: template.test_name,\n        sortable: false,\n        switchable: true,\n        render: (record: any) => {\n          const tests = record.tests || [];\n\n          // Find the most recent test result (highest primary key)\n          const test = tests\n            .filter((test: any) => test.template == template.pk)\n            .sort((a: any, b: any) => b.pk - a.pk)\n            .shift();\n\n          // No test result recorded\n          if (!test || test.result === undefined) {\n            return (\n              <Group gap='xs' wrap='nowrap' justify='space-between'>\n                <Badge color='lightblue' variant='filled'>{t`No Result`}</Badge>\n                <Tooltip label={t`Add Test Result`}>\n                  <ActionIcon\n                    size='lg'\n                    color='green'\n                    variant='transparent'\n                    onClick={(event: any) => {\n                      cancelEvent(event);\n                      setSelectedOutput(record.pk);\n                      setSelectedTemplate(template.pk);\n                      createTestResult.open();\n                    }}\n                  >\n                    <IconCirclePlus />\n                  </ActionIcon>\n                </Tooltip>\n              </Group>\n            );\n          }\n\n          const extra: ReactNode[] = [];\n\n          if (test.value) {\n            extra.push(\n              <Text key='value' size='sm'>\n                {t`Value`}: {test.value}\n              </Text>\n            );\n          }\n\n          if (test.notes) {\n            extra.push(\n              <Text key='notes' size='sm'>\n                {t`Notes`}: {test.notes}\n              </Text>\n            );\n          }\n\n          if (test.date) {\n            extra.push(\n              <Text key='date' size='sm'>\n                {t`Date`}: {formatDate(test.date)}\n              </Text>\n            );\n          }\n\n          if (test.user_detail) {\n            extra.push(<RenderUser key='user' instance={test.user_detail} />);\n          }\n\n          return (\n            <TableHoverCard\n              value={<PassFailButton value={test.result} />}\n              title={template.test_name}\n              extra={extra}\n            />\n          );\n        }\n      };\n    });\n  }, [testTemplates]);\n\n  const tableColumns: TableColumn[] = useMemo(() => {\n    // Fixed columns\n    const columns: TableColumn[] = [\n      {\n        accessor: 'stock',\n        title: t`Build Output`,\n        sortable: true,\n        switchable: false,\n        render: (record: any) => {\n          if (record.serial) {\n            return `# ${record.serial}`;\n          } else {\n            const extra: ReactNode[] = [];\n\n            if (record.batch) {\n              extra.push(\n                <Text key='batch' size='sm'>\n                  {t`Batch Code`}: {record.batch}\n                </Text>\n              );\n            }\n\n            return (\n              <TableHoverCard\n                value={\n                  <Text>\n                    {t`Quantity`}: {record.quantity}\n                  </Text>\n                }\n                title={t`Build Output`}\n                extra={extra}\n              />\n            );\n          }\n        }\n      },\n      LocationColumn({\n        accessor: 'location_detail'\n      })\n    ];\n\n    return [...columns, ...testColumns];\n  }, [testColumns]);\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'is_building',\n        label: t`In Production`,\n        description: t`Show build outputs currently in production`\n      }\n    ];\n  }, []);\n\n  const tableActions = useMemo(() => {\n    return [];\n  }, []);\n\n  return (\n    <>\n      {createTestResult.modal}\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.stock_item_list)}\n        tableState={table}\n        columns={tableColumns}\n        props={{\n          params: {\n            part_detail: true,\n            location_detail: true,\n            tests: true,\n            build: buildId\n          },\n          tableFilters: tableFilters,\n          tableActions: tableActions,\n          modelType: ModelType.stockitem\n        }}\n      />\n    </>\n  );\n}\n","import { t } from '@lingui/core/macro';\nimport {\n  Alert,\n  Divider,\n  Drawer,\n  Group,\n  Paper,\n  Space,\n  Stack,\n  Text\n} from '@mantine/core';\nimport { useDisclosure } from '@mantine/hooks';\nimport {\n  IconBuildingFactory2,\n  IconCircleCheck,\n  IconCircleX,\n  IconExclamationCircle\n} from '@tabler/icons-react';\nimport { useQuery } from '@tanstack/react-query';\nimport { useCallback, useEffect, useMemo, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\n\nimport { ActionButton } from '@lib/components/ActionButton';\nimport { AddItemButton } from '@lib/components/AddItemButton';\nimport { ProgressBar } from '@lib/components/ProgressBar';\nimport {\n  type RowAction,\n  RowEditAction,\n  RowViewAction\n} from '@lib/components/RowActions';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { TableColumn } from '@lib/types/Tables';\nimport { StylishText } from '../../components/items/StylishText';\nimport { useApi } from '../../contexts/ApiContext';\nimport {\n  useBuildOrderOutputFields,\n  useCancelBuildOutputsForm,\n  useCompleteBuildOutputsForm,\n  useScrapBuildOutputsForm\n} from '../../forms/BuildForms';\nimport {\n  type StockOperationProps,\n  useStockFields,\n  useStockItemSerializeFields\n} from '../../forms/StockForms';\nimport { InvenTreeIcon } from '../../functions/icons';\nimport {\n  useCreateApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport useStatusCodes from '../../hooks/UseStatusCodes';\nimport { useStockAdjustActions } from '../../hooks/UseStockAdjustActions';\nimport { useTable } from '../../hooks/UseTable';\nimport { useUserState } from '../../states/UserState';\nimport { LocationColumn, PartColumn, StatusColumn } from '../ColumnRenderers';\nimport {\n  BatchFilter,\n  HasBatchCodeFilter,\n  IsSerializedFilter,\n  SerialFilter,\n  SerialGTEFilter,\n  SerialLTEFilter,\n  StatusFilterOptions,\n  StockLocationFilter\n} from '../Filter';\nimport { InvenTreeTable } from '../InvenTreeTable';\nimport { TableHoverCard } from '../TableHoverCard';\nimport BuildLineTable from './BuildLineTable';\n\ntype TestResultOverview = {\n  name: string;\n  result: boolean;\n};\n\n/**\n * Detail drawer view for allocating stock against a specific build output\n */\nfunction OutputAllocationDrawer({\n  build,\n  output,\n  opened,\n  close\n}: Readonly<{\n  build: any;\n  output: any;\n  opened: boolean;\n  close: () => void;\n}>) {\n  return (\n    <Drawer\n      position='bottom'\n      size='lg'\n      title={\n        <Group p='md' wrap='nowrap' justify='space-apart'>\n          <StylishText size='lg'>{t`Build Output Stock Allocation`}</StylishText>\n          <Space h='lg' />\n          <PartColumn part={build.part_detail} />\n          {output?.serial && (\n            <Text size='sm'>\n              {t`Serial Number`}: {output.serial}\n            </Text>\n          )}\n          {output?.batch && (\n            <Text size='sm'>\n              {t`Batch Code`}: {output.batch}\n            </Text>\n          )}\n          <Space h='lg' />\n        </Group>\n      }\n      opened={opened}\n      onClose={close}\n      withCloseButton\n      closeOnEscape\n      closeOnClickOutside\n      styles={{\n        header: {\n          width: '100%'\n        },\n        title: {\n          width: '100%'\n        }\n      }}\n    >\n      <Divider />\n      <Paper p='md'>\n        <BuildLineTable\n          build={build}\n          output={output}\n          params={{\n            tracked: true\n          }}\n        />\n      </Paper>\n    </Drawer>\n  );\n}\n\nexport default function BuildOutputTable({\n  build,\n  refreshBuild\n}: Readonly<{ build: any; refreshBuild: () => void }>) {\n  const api = useApi();\n  const user = useUserState();\n  const navigate = useNavigate();\n  const table = useTable('build-outputs');\n\n  const buildId: number = useMemo(() => {\n    return build.pk ?? -1;\n  }, [build.pk]);\n\n  const partId: number = useMemo(() => {\n    return build.part ?? -1;\n  }, [build.part]);\n\n  const buildStatus = useStatusCodes({ modelType: ModelType.build });\n\n  // Fetch the test templates associated with the partId\n  const { data: testTemplates, refetch: refetchTestTemplates } = useQuery({\n    queryKey: ['buildoutputtests', partId, build],\n    queryFn: async () => {\n      if (!partId || partId < 0) {\n        return [];\n      }\n\n      // If the part is not testable, return an empty array\n      if (!build?.part_detail?.testable) {\n        return [];\n      }\n\n      return api\n        .get(apiUrl(ApiEndpoints.part_test_template_list), {\n          params: {\n            part: partId,\n            include_inherited: true,\n            enabled: true,\n            required: true\n          }\n        })\n        .then((response) => response.data);\n    }\n  });\n\n  const hasRequiredTests: boolean = useMemo(() => {\n    return (testTemplates?.length ?? 0) > 0;\n  }, [partId, testTemplates]);\n\n  // Fetch the \"tracked\" BOM items associated with the partId\n  const { data: trackedItems, refetch: refetchTrackedItems } = useQuery({\n    queryKey: ['trackeditems', buildId],\n    queryFn: async () => {\n      if (!buildId || buildId < 0) {\n        return [];\n      }\n\n      return api\n        .get(apiUrl(ApiEndpoints.build_line_list), {\n          params: {\n            build: buildId,\n            tracked: true\n          }\n        })\n        .then((response) => response.data);\n    }\n  });\n\n  const hasTrackedItems: boolean = useMemo(() => {\n    return (trackedItems?.length ?? 0) > 0;\n  }, [trackedItems]);\n\n  // Ensure base table data is updated correctly\n  useEffect(() => {\n    table.refreshTable();\n  }, [testTemplates, trackedItems, hasTrackedItems, hasRequiredTests]);\n\n  // Format table records\n  const formatRecords = useCallback(\n    (records: any[]): any[] => {\n      records?.forEach((record: any, index: number) => {\n        // Test result information, per record\n        const results: TestResultOverview[] = [];\n        let passCount = 0;\n\n        // Iterate through each\n        testTemplates?.forEach((template: any) => {\n          // Find the \"newest\" result for this template in the returned data\n          const result = record.tests\n            ?.filter((test: any) => test.template == template.pk)\n            .sort((a: any, b: any) => {\n              return a.pk < b.pk ? 1 : -1;\n            })\n            .shift();\n\n          if (template?.required && result?.result) {\n            passCount += 1;\n          }\n\n          results.push({\n            name: template.test_name,\n            result: result?.result ?? false\n          });\n        });\n\n        records[index].passCount = passCount;\n        records[index].results = results;\n\n        // Stock allocation information, per record\n        let fullyAllocatedCount = 0;\n\n        // Iterate through each tracked item\n        trackedItems?.forEach((item: any) => {\n          let allocated = 0;\n\n          // Find all allocations which match the build output\n          item.allocations\n            ?.filter((allocation: any) => allocation.install_into == record.pk)\n            ?.forEach((allocation: any) => {\n              allocated += allocation.quantity;\n            });\n\n          if (allocated >= item.bom_item_detail.quantity) {\n            fullyAllocatedCount += 1;\n          }\n        });\n\n        records[index].fullyAllocated = fullyAllocatedCount;\n      });\n\n      return records;\n    },\n    [partId, buildId, testTemplates, trackedItems]\n  );\n\n  const buildOutputFields = useBuildOrderOutputFields({\n    build: build,\n    modalId: 'add-build-output'\n  });\n\n  const addBuildOutput = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.build_output_create, buildId),\n    title: t`Add Build Output`,\n    modalId: 'add-build-output',\n    fields: buildOutputFields,\n    successMessage: t`Build output created`,\n    timeout: 10000,\n    initialData: {\n      batch_code: build.batch,\n      location: build.destination ?? build.part_detail?.default_location\n    },\n    onFormSuccess: () => {\n      // Refresh all associated table data\n      refetchTrackedItems();\n      refetchTestTemplates();\n      table.refreshTable(true);\n    }\n  });\n\n  const [selectedOutputs, setSelectedOutputs] = useState<any[]>([]);\n\n  const completeBuildOutputsForm = useCompleteBuildOutputsForm({\n    build: build,\n    outputs: selectedOutputs,\n    onFormSuccess: () => {\n      table.refreshTable(true);\n      refreshBuild();\n    }\n  });\n\n  const scrapBuildOutputsForm = useScrapBuildOutputsForm({\n    build: build,\n    outputs: selectedOutputs,\n    onFormSuccess: () => {\n      table.refreshTable(true);\n      refreshBuild();\n    }\n  });\n\n  const cancelBuildOutputsForm = useCancelBuildOutputsForm({\n    build: build,\n    outputs: selectedOutputs,\n    onFormSuccess: () => {\n      table.refreshTable(true);\n      refreshBuild();\n    }\n  });\n\n  const editStockItemFields = useStockFields({\n    create: false,\n    partId: partId,\n    stockItem: selectedOutputs[0],\n    modalId: 'edit-build-output'\n  });\n\n  const editBuildOutput = useEditApiFormModal({\n    url: ApiEndpoints.stock_item_list,\n    pk: selectedOutputs[0]?.pk,\n    title: t`Edit Build Output`,\n    modalId: 'edit-build-output',\n    fields: editStockItemFields,\n    table: table\n  });\n\n  const deallocateBuildOutput = useCreateApiFormModal({\n    url: ApiEndpoints.build_order_deallocate,\n    pk: build.pk,\n    title: t`Deallocate Stock`,\n    preFormContent: (\n      <Alert\n        color='yellow'\n        icon={<IconExclamationCircle />}\n        title={t`Deallocate Stock`}\n      >\n        {t`This action will deallocate all stock from the selected build output`}\n      </Alert>\n    ),\n    fields: {\n      output: {\n        hidden: true\n      }\n    },\n    initialData: {\n      output: selectedOutputs[0]?.pk\n    },\n    onFormSuccess: () => {\n      refetchTrackedItems();\n    }\n  });\n\n  const serializeStockFields = useStockItemSerializeFields({\n    partId: selectedOutputs[0]?.part,\n    trackable: selectedOutputs[0]?.part_detail?.trackable,\n    modalId: 'build-output-serialize'\n  });\n\n  const serializeOutput = useCreateApiFormModal({\n    url: ApiEndpoints.stock_serialize,\n    pk: selectedOutputs[0]?.pk,\n    title: t`Serialize Build Output`,\n    modalId: 'build-output-serialize',\n    fields: serializeStockFields,\n    initialData: {\n      quantity: selectedOutputs[0]?.quantity ?? 1,\n      destination: selectedOutputs[0]?.location ?? build.destination\n    },\n    onFormSuccess: () => {\n      table.refreshTable(true);\n      refreshBuild();\n    }\n  });\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'status',\n        label: t`Status`,\n        description: t`Filter by stock status`,\n        choiceFunction: StatusFilterOptions(ModelType.stockitem)\n      },\n      StockLocationFilter(),\n      HasBatchCodeFilter(),\n      BatchFilter(),\n      IsSerializedFilter(),\n      SerialFilter(),\n      SerialLTEFilter(),\n      SerialGTEFilter()\n    ];\n  }, []);\n\n  const stockOperationProps: StockOperationProps = useMemo(() => {\n    return {\n      items: table.selectedRecords,\n      model: ModelType.stockitem,\n      refresh: table.refreshTable,\n      filters: {}\n    };\n  }, [table.selectedRecords, table.refreshTable]);\n\n  const stockAdjustActions = useStockAdjustActions({\n    formProps: stockOperationProps,\n    merge: false,\n    assign: false,\n    delete: false,\n    add: false,\n    count: false,\n    remove: false\n  });\n\n  const tableActions = useMemo(() => {\n    return [\n      stockAdjustActions.dropdown,\n      <ActionButton\n        key='complete-selected-outputs'\n        tooltip={t`Complete selected outputs`}\n        icon={<InvenTreeIcon icon='success' />}\n        color='green'\n        disabled={!table.hasSelectedRecords}\n        onClick={() => {\n          setSelectedOutputs(table.selectedRecords);\n          completeBuildOutputsForm.open();\n        }}\n      />,\n      <ActionButton\n        key='scrap-selected-outputs'\n        tooltip={t`Scrap selected outputs`}\n        icon={<InvenTreeIcon icon='delete' />}\n        color='red'\n        disabled={!table.hasSelectedRecords}\n        onClick={() => {\n          setSelectedOutputs(table.selectedRecords);\n          scrapBuildOutputsForm.open();\n        }}\n      />,\n      <ActionButton\n        key='cancel-selected-outputs'\n        tooltip={t`Cancel selected outputs`}\n        icon={<InvenTreeIcon icon='cancel' />}\n        color='red'\n        disabled={!table.hasSelectedRecords}\n        onClick={() => {\n          setSelectedOutputs(table.selectedRecords);\n          cancelBuildOutputsForm.open();\n        }}\n      />,\n      <AddItemButton\n        key='add-build-output'\n        tooltip={t`Add Build Output`}\n        hidden={build.external || !user.hasAddRole(UserRoles.build)}\n        onClick={addBuildOutput.open}\n      />\n    ];\n  }, [\n    build,\n    user,\n    table.selectedRecords,\n    table.hasSelectedRecords,\n    stockAdjustActions.dropdown\n  ]);\n\n  const rowActions = useCallback(\n    (record: any): RowAction[] => {\n      const production = build?.status == buildStatus.PRODUCTION;\n\n      return [\n        RowViewAction({\n          title: t`View Build Output`,\n          modelId: record.pk,\n          modelType: ModelType.stockitem,\n          navigate: navigate\n        }),\n        {\n          title: t`Allocate`,\n          tooltip: t`Allocate stock to build output`,\n          color: 'blue',\n          hidden:\n            !production ||\n            !hasTrackedItems ||\n            !user.hasChangeRole(UserRoles.build),\n          icon: <InvenTreeIcon icon='plus' />,\n          onClick: () => {\n            setSelectedOutputs([record]);\n            openAllocationDrawer();\n          }\n        },\n        {\n          title: t`Deallocate`,\n          tooltip: t`Deallocate stock from build output`,\n          color: 'red',\n          hidden:\n            !production ||\n            !hasTrackedItems ||\n            !user.hasChangeRole(UserRoles.build),\n          icon: <InvenTreeIcon icon='minus' />,\n          onClick: () => {\n            setSelectedOutputs([record]);\n            deallocateBuildOutput.open();\n          }\n        },\n        {\n          title: t`Serialize`,\n          tooltip: t`Serialize build output`,\n          color: 'blue',\n          hidden: !record.part_detail?.trackable || !!record.serial,\n          icon: <InvenTreeIcon icon='serial' />,\n          onClick: () => {\n            setSelectedOutputs([record]);\n            serializeOutput.open();\n          }\n        },\n        {\n          title: t`Complete`,\n          tooltip: t`Complete build output`,\n          color: 'green',\n          icon: <InvenTreeIcon icon='success' />,\n          onClick: () => {\n            setSelectedOutputs([record]);\n            completeBuildOutputsForm.open();\n          }\n        },\n        RowEditAction({\n          tooltip: t`Edit Build Output`,\n          onClick: () => {\n            setSelectedOutputs([record]);\n            editBuildOutput.open();\n          }\n        }),\n        {\n          title: t`Scrap`,\n          tooltip: t`Scrap build output`,\n          icon: <InvenTreeIcon icon='delete' />,\n          color: 'red',\n          onClick: () => {\n            setSelectedOutputs([record]);\n            scrapBuildOutputsForm.open();\n          }\n        },\n        {\n          title: t`Cancel`,\n          tooltip: t`Cancel build output`,\n          icon: <InvenTreeIcon icon='cancel' />,\n          color: 'red',\n          onClick: () => {\n            setSelectedOutputs([record]);\n            cancelBuildOutputsForm.open();\n          }\n        }\n      ];\n    },\n    [buildStatus, user, partId, hasTrackedItems]\n  );\n\n  const tableColumns: TableColumn[] = useMemo(() => {\n    return [\n      {\n        accessor: 'part',\n        sortable: true,\n        render: (record: any) => PartColumn({ part: record?.part_detail })\n      },\n      {\n        accessor: 'quantity',\n        ordering: 'stock',\n        sortable: true,\n        switchable: false,\n        title: t`Build Output`,\n        render: (record: any) => {\n          let text = record.quantity;\n\n          if (record.serial) {\n            text = `# ${record.serial}`;\n          }\n\n          return text;\n        }\n      },\n      {\n        accessor: 'batch',\n        sortable: true\n      },\n      StatusColumn({\n        accessor: 'status',\n        sortable: true,\n        model: ModelType.stockitem\n      }),\n      LocationColumn({\n        accessor: 'location_detail'\n      }),\n      {\n        accessor: 'allocations',\n        sortable: false,\n        switchable: false,\n        hidden: !hasTrackedItems,\n        title: t`Allocated Lines`,\n        render: (record: any) => {\n          return (\n            <ProgressBar\n              progressLabel\n              value={record.fullyAllocated ?? 0}\n              maximum={trackedItems?.length ?? 0}\n            />\n          );\n        }\n      },\n      {\n        accessor: 'tests',\n        sortable: false,\n        switchable: false,\n        title: t`Required Tests`,\n        hidden: !hasRequiredTests,\n        render: (record: any) => {\n          const extra =\n            record.results?.map((result: TestResultOverview) => {\n              return (\n                result && (\n                  <Group justify='left' key={result.name} wrap='nowrap'>\n                    {result.result ? (\n                      <IconCircleCheck color='green' />\n                    ) : (\n                      <IconCircleX color='red' />\n                    )}\n                    <Text>{result.name}</Text>\n                  </Group>\n                )\n              );\n            }) ?? [];\n\n          return (\n            <TableHoverCard\n              value={\n                <ProgressBar\n                  progressLabel\n                  value={record.passCount ?? 0}\n                  maximum={testTemplates?.length ?? 0}\n                />\n              }\n              extra={extra}\n              title={t`Test Results`}\n            />\n          );\n        }\n      }\n    ];\n  }, [\n    buildId,\n    partId,\n    hasRequiredTests,\n    hasTrackedItems,\n    testTemplates,\n    trackedItems\n  ]);\n\n  const [\n    allocationDrawerOpen,\n    { open: openAllocationDrawer, close: closeAllocationDrawer }\n  ] = useDisclosure(false);\n\n  const closeDrawer = useCallback(() => {\n    closeAllocationDrawer();\n    refetchTrackedItems();\n  }, [closeAllocationDrawer, refetchTrackedItems]);\n\n  return (\n    <>\n      {addBuildOutput.modal}\n      {completeBuildOutputsForm.modal}\n      {scrapBuildOutputsForm.modal}\n      {editBuildOutput.modal}\n      {deallocateBuildOutput.modal}\n      {cancelBuildOutputsForm.modal}\n      {serializeOutput.modal}\n      {stockAdjustActions.modals.map((modal) => modal.modal)}\n      <OutputAllocationDrawer\n        build={build}\n        output={selectedOutputs[0]}\n        opened={allocationDrawerOpen}\n        close={closeDrawer}\n      />\n      <Stack gap='xs'>\n        {build.external && (\n          <Alert\n            color='blue'\n            icon={<IconBuildingFactory2 />}\n            title={t`External Build`}\n          >\n            {t`This build order is fulfilled by an external purchase order`}\n          </Alert>\n        )}\n        <InvenTreeTable\n          tableState={table}\n          url={apiUrl(ApiEndpoints.stock_item_list)}\n          columns={tableColumns}\n          props={{\n            params: {\n              part_detail: true,\n              location_detail: true,\n              tests: true,\n              is_building: true,\n              build: buildId\n            },\n            enableLabels: true,\n            enableReports: true,\n            modelType: ModelType.stockitem,\n            dataFormatter: formatRecords,\n            tableFilters: tableFilters,\n            tableActions: tableActions,\n            rowActions: rowActions,\n            enableSelection: true,\n            onRowClick: (record: any) => {\n              if (hasTrackedItems && !!record.serial) {\n                setSelectedOutputs([record]);\n                openAllocationDrawer();\n              }\n            }\n          }}\n        />\n      </Stack>\n    </>\n  );\n}\n","import { t } from '@lingui/core/macro';\nimport { Alert, Grid, Skeleton, Stack, Text } from '@mantine/core';\nimport {\n  IconChecklist,\n  IconCircleCheck,\n  IconClipboardCheck,\n  IconClipboardList,\n  IconInfoCircle,\n  IconList,\n  IconListCheck,\n  IconListNumbers,\n  IconShoppingCart,\n  IconSitemap\n} from '@tabler/icons-react';\nimport { useMemo } from 'react';\nimport { useParams } from 'react-router-dom';\n\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport { getDetailUrl } from '@lib/functions/Navigation';\nimport type { ApiFormFieldSet } from '@lib/types/Forms';\nimport AdminButton from '../../components/buttons/AdminButton';\nimport PrimaryActionButton from '../../components/buttons/PrimaryActionButton';\nimport { PrintingActions } from '../../components/buttons/PrintingActions';\nimport {\n  type DetailsField,\n  DetailsTable\n} from '../../components/details/Details';\nimport DetailsBadge from '../../components/details/DetailsBadge';\nimport { DetailsImage } from '../../components/details/DetailsImage';\nimport { ItemDetailsGrid } from '../../components/details/ItemDetails';\nimport {\n  BarcodeActionDropdown,\n  CancelItemAction,\n  DuplicateItemAction,\n  EditItemAction,\n  HoldItemAction,\n  OptionsActionDropdown\n} from '../../components/items/ActionDropdown';\nimport InstanceDetail from '../../components/nav/InstanceDetail';\nimport { PageDetail } from '../../components/nav/PageDetail';\nimport AttachmentPanel from '../../components/panels/AttachmentPanel';\nimport NotesPanel from '../../components/panels/NotesPanel';\nimport type { PanelType } from '../../components/panels/Panel';\nimport { PanelGroup } from '../../components/panels/PanelGroup';\nimport { StatusRenderer } from '../../components/render/StatusRenderer';\nimport { useBuildOrderFields } from '../../forms/BuildForms';\nimport {\n  useCreateApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport { useInstance } from '../../hooks/UseInstance';\nimport useStatusCodes from '../../hooks/UseStatusCodes';\nimport { useGlobalSettingsState } from '../../states/SettingsStates';\nimport { useUserState } from '../../states/UserState';\nimport BuildAllocatedStockTable from '../../tables/build/BuildAllocatedStockTable';\nimport BuildLineTable from '../../tables/build/BuildLineTable';\nimport { BuildOrderTable } from '../../tables/build/BuildOrderTable';\nimport BuildOrderTestTable from '../../tables/build/BuildOrderTestTable';\nimport BuildOutputTable from '../../tables/build/BuildOutputTable';\nimport { PurchaseOrderTable } from '../../tables/purchasing/PurchaseOrderTable';\nimport { StockItemTable } from '../../tables/stock/StockItemTable';\n\nfunction NoItems() {\n  return (\n    <Alert color='blue' icon={<IconInfoCircle />} title={t`No Required Items`}>\n      <Stack gap='xs'>\n        <Text>{t`This build order does not have any required items.`}</Text>\n        <Text>{t`The assembled part may not have a Bill of Materials (BOM) defined, or the BOM is empty.`}</Text>\n      </Stack>\n    </Alert>\n  );\n}\n\n/**\n * Panel to display the lines of a build order\n */\nfunction BuildLinesPanel({\n  build,\n  isLoading,\n  hasItems\n}: Readonly<{\n  build: any;\n  isLoading: boolean;\n  hasItems: boolean;\n}>) {\n  if (isLoading || !build.pk) {\n    return <Skeleton w={'100%'} h={400} animate />;\n  }\n\n  if (!hasItems) {\n    return <NoItems />;\n  }\n\n  return <BuildLineTable build={build} />;\n}\n\nfunction BuildAllocationsPanel({\n  build,\n  isLoading,\n  hasItems\n}: Readonly<{\n  build: any;\n  isLoading: boolean;\n  hasItems: boolean;\n}>) {\n  if (isLoading || !build.pk) {\n    return <Skeleton w={'100%'} h={400} animate />;\n  }\n\n  if (!hasItems) {\n    return <NoItems />;\n  }\n\n  return <BuildAllocatedStockTable buildId={build.pk} showPartInfo allowEdit />;\n}\n\n/**\n * Detail page for a single Build Order\n */\nexport default function BuildDetail() {\n  const { id } = useParams();\n\n  const user = useUserState();\n  const globalSettings = useGlobalSettingsState();\n\n  // Fetch the number of BOM items associated with the build order\n  const { instance: buildLineData, instanceQuery: buildLineQuery } =\n    useInstance({\n      endpoint: ApiEndpoints.build_line_list,\n      params: {\n        build: id,\n        allocations: false,\n        part_detail: false,\n        build_detail: false,\n        bom_item_detail: false,\n        limit: 1\n      },\n      disabled: !id,\n      hasPrimaryKey: false,\n      defaultValue: {}\n    });\n\n  const buildStatus = useStatusCodes({ modelType: ModelType.build });\n\n  const {\n    instance: build,\n    refreshInstance,\n    instanceQuery\n  } = useInstance({\n    endpoint: ApiEndpoints.build_order_list,\n    pk: id,\n    params: {\n      part_detail: true\n    },\n    refetchOnMount: true\n  });\n\n  const { instance: partRequirements, instanceQuery: partRequirementsQuery } =\n    useInstance({\n      endpoint: ApiEndpoints.part_requirements,\n      pk: build?.part,\n      hasPrimaryKey: true,\n      defaultValue: {}\n    });\n\n  const detailsPanel = useMemo(() => {\n    if (instanceQuery.isFetching) {\n      return <Skeleton />;\n    }\n\n    const data = {\n      ...build,\n      can_build: partRequirements?.can_build ?? 0\n    };\n\n    const tl: DetailsField[] = [\n      {\n        type: 'link',\n        name: 'part',\n        label: t`Part`,\n        model: ModelType.part\n      },\n      {\n        type: 'text',\n        name: 'part_detail.IPN',\n        icon: 'part',\n        label: t`IPN`,\n        hidden: !build.part_detail?.IPN,\n        copy: true\n      },\n      {\n        type: 'string',\n        name: 'part_detail.revision',\n        icon: 'revision',\n        label: t`Revision`,\n        hidden: !build.part_detail?.revision,\n        copy: true\n      },\n      {\n        type: 'status',\n        name: 'status',\n        label: t`Status`,\n        model: ModelType.build\n      },\n      {\n        type: 'status',\n        name: 'status_custom_key',\n        label: t`Custom Status`,\n        model: ModelType.build,\n        icon: 'status',\n        hidden:\n          !build.status_custom_key || build.status_custom_key == build.status\n      },\n      {\n        type: 'boolean',\n        name: 'external',\n        label: t`External`,\n        icon: 'manufacturers',\n        hidden: !build.external\n      },\n      {\n        type: 'text',\n        name: 'purchase_order',\n        label: t`Purchase Order`,\n        icon: 'purchase_orders',\n        copy: true,\n        hidden: !build.external,\n        value_formatter: () => {\n          return 'TODO: external PO';\n        }\n      },\n      {\n        type: 'text',\n        name: 'reference',\n        label: t`Reference`,\n        copy: true\n      },\n      {\n        type: 'text',\n        name: 'title',\n        label: t`Description`,\n        icon: 'description',\n        copy: true\n      },\n      {\n        type: 'link',\n        name: 'parent',\n        icon: 'builds',\n        label: t`Parent Build`,\n        model_field: 'reference',\n        model: ModelType.build,\n        hidden: !build.parent\n      }\n    ];\n\n    const tr: DetailsField[] = [\n      {\n        type: 'number',\n        name: 'quantity',\n        label: t`Build Quantity`\n      },\n      {\n        type: 'number',\n        name: 'can_build',\n        unit: build.part_detail?.units,\n        label: t`Can Build`,\n        hidden: partRequirementsQuery.isFetching\n      },\n      {\n        type: 'progressbar',\n        name: 'completed',\n        icon: 'progress',\n        total: build.quantity,\n        progress: build.completed,\n        label: t`Completed Outputs`\n      },\n      {\n        type: 'link',\n        name: 'sales_order',\n        label: t`Sales Order`,\n        icon: 'sales_orders',\n        model: ModelType.salesorder,\n        model_field: 'reference',\n        hidden: !build.sales_order\n      }\n    ];\n\n    const bl: DetailsField[] = [\n      {\n        type: 'text',\n        name: 'issued_by',\n        label: t`Issued By`,\n        icon: 'user',\n        badge: 'user',\n        hidden: !build.issued_by\n      },\n      {\n        type: 'text',\n        name: 'responsible',\n        label: t`Responsible`,\n        badge: 'owner',\n        hidden: !build.responsible\n      },\n      {\n        type: 'text',\n        name: 'project_code_label',\n        label: t`Project Code`,\n        icon: 'reference',\n        copy: true,\n        hidden: !build.project_code\n      },\n      {\n        type: 'link',\n        name: 'take_from',\n        icon: 'location',\n        model: ModelType.stocklocation,\n        label: t`Source Location`,\n        backup_value: t`Any location`\n      },\n      {\n        type: 'link',\n        name: 'destination',\n        icon: 'location',\n        model: ModelType.stocklocation,\n        label: t`Destination Location`,\n        hidden: !build.destination\n      },\n      {\n        type: 'text',\n        name: 'batch',\n        label: t`Batch Code`,\n        hidden: !build.batch,\n        copy: true\n      }\n    ];\n\n    const br: DetailsField[] = [\n      {\n        type: 'date',\n        name: 'creation_date',\n        label: t`Created`,\n        icon: 'calendar',\n        copy: true,\n        hidden: !build.creation_date\n      },\n      {\n        type: 'date',\n        name: 'start_date',\n        label: t`Start Date`,\n        icon: 'calendar',\n        copy: true,\n        hidden: !build.start_date\n      },\n      {\n        type: 'date',\n        name: 'target_date',\n        label: t`Target Date`,\n        icon: 'calendar',\n        copy: true,\n        hidden: !build.target_date\n      },\n      {\n        type: 'date',\n        name: 'completion_date',\n        label: t`Completed`,\n        icon: 'calendar',\n        copy: true,\n        hidden: !build.completion_date\n      }\n    ];\n\n    return (\n      <ItemDetailsGrid>\n        <Grid grow>\n          <DetailsImage\n            appRole={UserRoles.part}\n            apiPath={ApiEndpoints.part_list}\n            src={build.part_detail?.image ?? build.part_detail?.thumbnail}\n            pk={build.part}\n          />\n          <Grid.Col span={{ base: 12, sm: 8 }}>\n            <DetailsTable fields={tl} item={data} />\n          </Grid.Col>\n        </Grid>\n        <DetailsTable fields={tr} item={data} />\n        <DetailsTable fields={bl} item={data} />\n        <DetailsTable fields={br} item={data} />\n      </ItemDetailsGrid>\n    );\n  }, [\n    build,\n    instanceQuery,\n    partRequirements,\n    partRequirementsQuery.isFetching\n  ]);\n\n  const buildPanels: PanelType[] = useMemo(() => {\n    return [\n      {\n        name: 'details',\n        label: t`Build Details`,\n        icon: <IconInfoCircle />,\n        content: detailsPanel\n      },\n      {\n        name: 'line-items',\n        label: t`Required Parts`,\n        icon: <IconListNumbers />,\n        content: (\n          <BuildLinesPanel\n            build={build}\n            isLoading={buildLineQuery.isFetching || buildLineQuery.isLoading}\n            hasItems={buildLineData?.count > 0}\n          />\n        )\n      },\n      {\n        name: 'allocated-stock',\n        label: t`Allocated Stock`,\n        icon: <IconList />,\n        hidden:\n          build.status == buildStatus.COMPLETE ||\n          build.status == buildStatus.CANCELLED ||\n          (buildLineData?.count ?? 0) <= 0, // Hide if no required parts\n        content: (\n          <BuildAllocationsPanel\n            build={build}\n            isLoading={buildLineQuery.isFetching || buildLineQuery.isLoading}\n            hasItems={buildLineData?.count > 0}\n          />\n        )\n      },\n      {\n        name: 'consumed-stock',\n        label: t`Consumed Stock`,\n        icon: <IconListCheck />,\n        hidden: (buildLineData?.count ?? 0) <= 0, // Hide if no required parts\n        content: (\n          <StockItemTable\n            allowAdd={false}\n            tableName='build-consumed'\n            showLocation={false}\n            allowReturn\n            params={{\n              consumed_by: id\n            }}\n          />\n        )\n      },\n      {\n        name: 'incomplete-outputs',\n        label: t`Incomplete Outputs`,\n        icon: <IconClipboardList />,\n        content: build.pk ? (\n          <BuildOutputTable build={build} refreshBuild={refreshInstance} />\n        ) : (\n          <Skeleton />\n        ),\n        hidden:\n          build.status == buildStatus.COMPLETE ||\n          build.status == buildStatus.CANCELLED\n      },\n      {\n        name: 'complete-outputs',\n        label: t`Completed Outputs`,\n        icon: <IconClipboardCheck />,\n        content: (\n          <StockItemTable\n            allowAdd={false}\n            tableName='completed-build-outputs'\n            params={{\n              build: id,\n              is_building: false\n            }}\n          />\n        )\n      },\n      {\n        name: 'external-purchase-orders',\n        label: t`External Orders`,\n        icon: <IconShoppingCart />,\n        content: build.pk ? (\n          <PurchaseOrderTable externalBuildId={build.pk} />\n        ) : (\n          <Skeleton />\n        ),\n        hidden:\n          !user.hasViewRole(UserRoles.purchase_order) ||\n          !build.external ||\n          !globalSettings.isSet('BUILDORDER_EXTERNAL_BUILDS')\n      },\n      {\n        name: 'child-orders',\n        label: t`Child Build Orders`,\n        icon: <IconSitemap />,\n        content: build.pk ? (\n          <BuildOrderTable parentBuildId={build.pk} />\n        ) : (\n          <Skeleton />\n        )\n      },\n      {\n        name: 'test-results',\n        label: t`Test Results`,\n        icon: <IconChecklist />,\n        hidden: !build.part_detail?.testable,\n        content: build.pk ? (\n          <BuildOrderTestTable buildId={build.pk} partId={build.part} />\n        ) : (\n          <Skeleton />\n        )\n      },\n      AttachmentPanel({\n        model_type: ModelType.build,\n        model_id: build.pk\n      }),\n      NotesPanel({\n        model_type: ModelType.build,\n        model_id: build.pk\n      })\n    ];\n  }, [\n    build,\n    id,\n    user,\n    buildStatus,\n    globalSettings,\n    buildLineQuery.isFetching,\n    buildLineQuery.isLoading,\n    buildLineData\n  ]);\n\n  const editBuildOrderFields = useBuildOrderFields({\n    create: false,\n    modalId: 'edit-build-order'\n  });\n\n  const editBuild = useEditApiFormModal({\n    url: ApiEndpoints.build_order_list,\n    pk: build.pk,\n    title: t`Edit Build Order`,\n    modalId: 'edit-build-order',\n    fields: editBuildOrderFields,\n    onFormSuccess: refreshInstance\n  });\n\n  const duplicateBuildOrderInitialData = useMemo(() => {\n    const data = { ...build };\n    // if we set the reference to null/undefined, it will be left blank in the form\n    // if we omit the reference altogether, it will be auto-generated via reference pattern\n    // from the OPTIONS response\n    delete data.reference;\n    return data;\n  }, [build]);\n\n  const duplicateBuildOrderFields = useBuildOrderFields({\n    create: false,\n    modalId: 'duplicate-build-order'\n  });\n\n  const duplicateBuild = useCreateApiFormModal({\n    url: ApiEndpoints.build_order_list,\n    title: t`Add Build Order`,\n    modalId: 'duplicate-build-order',\n    fields: duplicateBuildOrderFields,\n    initialData: duplicateBuildOrderInitialData,\n    follow: true,\n    modelType: ModelType.build\n  });\n\n  const cancelOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.build_order_cancel, build.pk),\n    title: t`Cancel Build Order`,\n    onFormSuccess: refreshInstance,\n    successMessage: t`Order cancelled`,\n    preFormWarning: t`Cancel this order`,\n    fields: {\n      remove_allocated_stock: {},\n      remove_incomplete_outputs: {}\n    }\n  });\n\n  const holdOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.build_order_hold, build.pk),\n    title: t`Hold Build Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Place this order on hold`,\n    successMessage: t`Order placed on hold`\n  });\n\n  const issueOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.build_order_issue, build.pk),\n    title: t`Issue Build Order`,\n    onFormSuccess: refreshInstance,\n    preFormWarning: t`Issue this order`,\n    successMessage: t`Order issued`\n  });\n\n  const completeOrderFields: ApiFormFieldSet = useMemo(() => {\n    const hasBom = (buildLineData?.count ?? 0) > 0;\n\n    return {\n      accept_overallocated: {\n        hidden: !hasBom\n      },\n      accept_unallocated: {\n        hidden: !hasBom\n      },\n      accept_incomplete: {}\n    };\n  }, [buildLineData.count]);\n\n  const completeOrder = useCreateApiFormModal({\n    url: apiUrl(ApiEndpoints.build_order_complete, build.pk),\n    title: t`Complete Build Order`,\n    onFormSuccess: refreshInstance,\n    preFormContent: (\n      <Alert\n        color='green'\n        icon={<IconCircleCheck />}\n        title={t`Mark this order as complete`}\n      />\n    ),\n    successMessage: t`Order completed`,\n    fields: completeOrderFields\n  });\n\n  const buildActions = useMemo(() => {\n    const canEdit = user.hasChangeRole(UserRoles.build);\n\n    const canIssue =\n      canEdit &&\n      (build.status == buildStatus.PENDING ||\n        build.status == buildStatus.ON_HOLD);\n\n    const canComplete = canEdit && build.status == buildStatus.PRODUCTION;\n\n    const canHold =\n      canEdit &&\n      (build.status == buildStatus.PENDING ||\n        build.status == buildStatus.PRODUCTION);\n\n    const canCancel =\n      canEdit &&\n      (build.status == buildStatus.PENDING ||\n        build.status == buildStatus.ON_HOLD ||\n        build.status == buildStatus.PRODUCTION);\n\n    return [\n      <PrimaryActionButton\n        title={t`Issue Order`}\n        icon='issue'\n        hidden={!canIssue}\n        color='blue'\n        onClick={issueOrder.open}\n      />,\n      <PrimaryActionButton\n        title={t`Complete Order`}\n        icon='complete'\n        hidden={!canComplete}\n        color='green'\n        onClick={completeOrder.open}\n      />,\n      <AdminButton model={ModelType.build} id={build.pk} />,\n      <BarcodeActionDropdown\n        model={ModelType.build}\n        pk={build.pk}\n        hash={build?.barcode_hash}\n      />,\n      <PrintingActions\n        modelType={ModelType.build}\n        items={[build.pk]}\n        enableReports\n      />,\n      <OptionsActionDropdown\n        tooltip={t`Build Order Actions`}\n        actions={[\n          EditItemAction({\n            onClick: () => editBuild.open(),\n            hidden: !canEdit,\n            tooltip: t`Edit order`\n          }),\n          DuplicateItemAction({\n            onClick: () => duplicateBuild.open(),\n            tooltip: t`Duplicate order`,\n            hidden: !user.hasAddRole(UserRoles.build)\n          }),\n          HoldItemAction({\n            tooltip: t`Hold order`,\n            hidden: !canHold,\n            onClick: holdOrder.open\n          }),\n          CancelItemAction({\n            tooltip: t`Cancel order`,\n            onClick: cancelOrder.open,\n            hidden: !canCancel\n          })\n        ]}\n      />\n    ];\n  }, [id, build, user, buildStatus]);\n\n  const buildBadges = useMemo(() => {\n    return instanceQuery.isFetching\n      ? []\n      : [\n          <StatusRenderer\n            status={build.status_custom_key}\n            type={ModelType.build}\n            options={{ size: 'lg' }}\n          />,\n          <DetailsBadge\n            label={t`External`}\n            color='blue'\n            key='external'\n            visible={build.external}\n          />\n        ];\n  }, [build, instanceQuery]);\n\n  return (\n    <>\n      {editBuild.modal}\n      {duplicateBuild.modal}\n      {cancelOrder.modal}\n      {holdOrder.modal}\n      {issueOrder.modal}\n      {completeOrder.modal}\n      <InstanceDetail query={instanceQuery} requiredRole={UserRoles.build}>\n        <Stack gap='xs'>\n          <PageDetail\n            title={`${t`Build Order`}: ${build.reference}`}\n            subtitle={`${build.quantity} x ${build.part_detail?.full_name}`}\n            badges={buildBadges}\n            editAction={editBuild.open}\n            editEnabled={user.hasChangePermission(ModelType.part)}\n            imageUrl={build.part_detail?.image ?? build.part_detail?.thumbnail}\n            breadcrumbs={[{ name: t`Manufacturing`, url: '/manufacturing' }]}\n            lastCrumb={[\n              {\n                name: build.reference,\n                url: getDetailUrl(ModelType.build, build.pk)\n              }\n            ]}\n            actions={buildActions}\n          />\n          <PanelGroup\n            pageKey='build'\n            panels={buildPanels}\n            instance={build}\n            reloadInstance={refreshInstance}\n            model={ModelType.build}\n            id={build.pk}\n          />\n        </Stack>\n      </InstanceDetail>\n    </>\n  );\n}\n"],"names":["BuildOrderTestTable","buildId","partId","table","useTable","api","useApi","data","testTemplates","useQuery","queryKey","queryFn","get","apiUrl","ApiEndpoints","part_test_template_list","params","part","include_inherited","enabled","required","then","res","useEffect","refreshTable","selectedOutput","setSelectedOutput","useState","selectedTemplate","setSelectedTemplate","testResultFields","useTestResultFields","itemId","templateId","createTestResult","useCreateApiFormModal","url","stock_test_result_list","title","_i18n","_","id","fields","initialData","template","result","onFormSuccess","successMessage","testColumns","useMemo","length","map","accessor","pk","test_name","sortable","switchable","render","record","test","tests","filter","sort","a","b","shift","undefined","Group","jsx","Badge","Tooltip","ActionIcon","event","cancelEvent","open","IconCirclePlus","extra","value","push","jsxs","Text","notes","date","formatDate","user_detail","RenderUser","TableHoverCard","PassFailButton","tableColumns","serial","batch","quantity","LocationColumn","tableFilters","name","label","description","tableActions","modal","InvenTreeTable","stock_item_list","part_detail","location_detail","build","modelType","ModelType","stockitem","OutputAllocationDrawer","output","opened","close","Drawer","StylishText","Space","PartColumn","header","width","Divider","Paper","BuildLineTable","tracked","BuildOutputTable","refreshBuild","user","useUserState","navigate","useNavigate","buildStatus","useStatusCodes","refetch","refetchTestTemplates","testable","response","hasRequiredTests","trackedItems","refetchTrackedItems","build_line_list","hasTrackedItems","formatRecords","useCallback","records","forEach","index","results","passCount","fullyAllocatedCount","item","allocated","allocations","allocation","install_into","bom_item_detail","fullyAllocated","buildOutputFields","useBuildOrderOutputFields","modalId","addBuildOutput","build_output_create","timeout","batch_code","location","destination","default_location","selectedOutputs","setSelectedOutputs","completeBuildOutputsForm","useCompleteBuildOutputsForm","outputs","scrapBuildOutputsForm","useScrapBuildOutputsForm","cancelBuildOutputsForm","useCancelBuildOutputsForm","editStockItemFields","useStockFields","create","stockItem","editBuildOutput","useEditApiFormModal","deallocateBuildOutput","build_order_deallocate","preFormContent","Alert","IconExclamationCircle","hidden","serializeStockFields","useStockItemSerializeFields","trackable","serializeOutput","stock_serialize","choiceFunction","StatusFilterOptions","StockLocationFilter","HasBatchCodeFilter","BatchFilter","IsSerializedFilter","SerialFilter","SerialLTEFilter","SerialGTEFilter","stockOperationProps","items","selectedRecords","model","refresh","filters","stockAdjustActions","useStockAdjustActions","formProps","merge","assign","delete","add","count","remove","dropdown","ActionButton","InvenTreeIcon","hasSelectedRecords","AddItemButton","external","hasAddRole","UserRoles","rowActions","production","status","PRODUCTION","RowViewAction","modelId","tooltip","color","hasChangeRole","icon","onClick","openAllocationDrawer","RowEditAction","ordering","text","StatusColumn","ProgressBar","IconCircleCheck","IconCircleX","allocationDrawerOpen","closeAllocationDrawer","useDisclosure","closeDrawer","modals","Stack","IconBuildingFactory2","is_building","enableLabels","enableReports","dataFormatter","enableSelection","onRowClick","NoItems","IconInfoCircle","BuildLinesPanel","isLoading","hasItems","Skeleton","BuildAllocationsPanel","BuildAllocatedStockTable","BuildDetail","useParams","globalSettings","useGlobalSettingsState","instance","buildLineData","instanceQuery","buildLineQuery","useInstance","endpoint","build_detail","limit","disabled","hasPrimaryKey","defaultValue","refreshInstance","build_order_list","refetchOnMount","partRequirements","partRequirementsQuery","part_requirements","detailsPanel","isFetching","can_build","tl","type","IPN","copy","revision","status_custom_key","value_formatter","model_field","parent","tr","unit","units","total","progress","completed","salesorder","sales_order","bl","badge","issued_by","responsible","project_code","stocklocation","backup_value","br","creation_date","start_date","target_date","completion_date","ItemDetailsGrid","Grid","DetailsImage","part_list","image","thumbnail","base","sm","DetailsTable","buildPanels","content","IconListNumbers","IconList","COMPLETE","CANCELLED","IconListCheck","StockItemTable","consumed_by","IconClipboardList","IconClipboardCheck","IconShoppingCart","PurchaseOrderTable","hasViewRole","purchase_order","isSet","IconSitemap","BuildOrderTable","IconChecklist","AttachmentPanel","model_type","model_id","NotesPanel","editBuildOrderFields","useBuildOrderFields","editBuild","duplicateBuildOrderInitialData","reference","duplicateBuildOrderFields","duplicateBuild","follow","cancelOrder","build_order_cancel","preFormWarning","remove_allocated_stock","remove_incomplete_outputs","holdOrder","build_order_hold","issueOrder","build_order_issue","completeOrderFields","hasBom","accept_overallocated","accept_unallocated","accept_incomplete","completeOrder","build_order_complete","buildActions","canEdit","canIssue","PENDING","ON_HOLD","canComplete","canHold","canCancel","PrimaryActionButton","AdminButton","BarcodeActionDropdown","barcode_hash","PrintingActions","OptionsActionDropdown","EditItemAction","DuplicateItemAction","HoldItemAction","CancelItemAction","buildBadges","StatusRenderer","size","DetailsBadge","InstanceDetail","PageDetail","full_name","hasChangePermission","getDetailUrl","PanelGroup"],"mappings":"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"}