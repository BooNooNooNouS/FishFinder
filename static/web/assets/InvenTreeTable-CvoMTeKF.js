import{b$ as rn,r,s as Me,bO as Q,j as n,i as t,n as Z,d as Se,I as on,c$ as ln,by as De,bc as pe,ae as Te,cv as A,cM as le,bJ as O,H as ee,cx as an,aA as Be,aG as cn,a8 as dn,ez as un,eA as mn,au as fn,cG as Le,bK as z,aw as pn,b7 as hn,b_ as gn,K as xn,cH as _n,c5 as Oe,eh as He,a4 as Cn,eB as jn,bP as qe,cK as bn,cD as yn,bR as ze,S as $,B as K,Y as Fn,G as Y,bS as kn,c0 as Pe,aB as wn,bU as Ae,cr as Tn,bd as An,dB as vn,dC as In,F as Rn}from"./vendor-DM3YzW4g.js";import{u as he,a as En}from"./DesktopAppView-ImH9xPLk.js";import{e as D,A as B,d as Mn,s as ve,o as Ue,f as ge,a as Sn,h as ae,n as ce,p as ne,m as P,D as Dn,E as de,u as Bn,t as Ie}from"./index-620rTnyc.js";import{I as Ne,q as Ln,S as Ve,k as ue,w as On,a as Hn,x as qn}from"./ThemeContext-D5ZWpaIU.js";import{P as Re,I as zn,q as Pn}from"./index-DOtB5fjC.js";import{u as me,F as xe,h as Un,G as Nn,v as Vn,b as Gn,H as Kn}from"./UseForm-Dpdzd-Qg.js";import{A as Yn}from"./ActionButton-t5SfA8IW.js";import{I as Qn,Q as $n,a as Jn}from"./QRCode-Dvpr48_R.js";function fe({title:s,id:e}){const i=he(),c=rn(),[o,u]=r.useState(!1);r.useEffect(()=>{e?(u(!0),Me({id:`data-output-${e}`,title:s,loading:!0,autoClose:!1,withCloseButton:!1,message:n.jsx(Re,{size:"lg",value:0,progressLabel:!0})})):u(!1)},[e,s]),Q({enabled:!!e&&o&&c==="visible",refetchInterval:500,queryKey:["data-output",e,s],queryFn:()=>i.get(D(B.data_output,e)).then(f=>{var x;const m=(f==null?void 0:f.data)??{};if(m.errors||m.error){u(!1);const l=(m==null?void 0:m.error)??((x=m==null?void 0:m.errors)==null?void 0:x.error)??t._({id:"gzjOvt"});Z.update({id:`data-output-${e}`,loading:!1,icon:n.jsx(Se,{}),autoClose:2500,title:s,message:l,color:"red"})}else if(m.complete){if(u(!1),Z.update({id:`data-output-${e}`,loading:!1,autoClose:2500,title:s,message:t._({id:"TCOQbo"}),color:"green",icon:n.jsx(on,{})}),m.output){const l=Mn(m.output);window.open(l.toString(),"_blank")}}else Z.update({id:`data-output-${e}`,loading:!0,autoClose:!1,withCloseButton:!1,message:n.jsx(Re,{size:"lg",maximum:m.total,value:m.progress,progressLabel:m.total>0,animated:!0})});return m}).catch(()=>(u(!1),Z.update({id:`data-output-${e}`,loading:!1,autoClose:2500,title:s,message:t._({id:"gzjOvt"}),color:"red"}),{}))})}function _e({icon:s,tooltip:e,tooltipPosition:i,actions:c,disabled:o=!1,hidden:u=!1,noindicator:f=!1}){const m=r.useMemo(()=>c.some(p=>!p.hidden),[c]),x=r.useMemo(()=>c.find(p=>p.indicator),[c]),l=r.useMemo(()=>ve(`action-menu-${e}`),[e]);return!u&&m?n.jsxs(A,{position:"bottom-end",children:[n.jsx(le,{disabled:!x,...x==null?void 0:x.indicator,children:n.jsx(A.Target,{children:n.jsx(O,{label:e,hidden:!e,position:i??"bottom",children:n.jsx(ee,{variant:f?"transparent":"light",disabled:o,"aria-label":l,p:"0",size:"sm",rightSection:f?null:n.jsx(an,{stroke:1.5}),styles:{section:{margin:0}},children:s})})})}),n.jsx(A.Dropdown,{children:c.map(p=>{const k=ve(`${l}-${p.name}`);return p.hidden?null:r.createElement(le,{disabled:!p.indicator,...p.indicator,key:p.name},n.jsx(O,{label:p.tooltip,hidden:!p.tooltip,position:"left",children:n.jsx(A.Item,{"aria-label":k,leftSection:p.icon,onClick:p.onClick,disabled:p.disabled,children:p.name})}))})})]},l):null}function yt({actions:s=[],tooltip:e=t._({id:"0zpgxV"}),hidden:i=!1}){return n.jsx(_e,{icon:n.jsx(ln,{}),tooltip:e,actions:s,hidden:i,noindicator:!0})}function Ft({model:s,pk:e,hash:i=null,actions:c=[],perm:o=!0}){const u=i===null,f={model:s,pk:e,hash:i};return n.jsx(_e,{tooltip:t._({id:"heU0Hk"}),icon:n.jsx(Te,{}),actions:[oe({mdl_prop:f,title:t._({id:"mYTVOy"}),icon:n.jsx(Te,{}),tooltip:t._({id:"PuPuVa"}),ChildItem:Qn}),oe({hidden:u||i||!o,mdl_prop:f,title:t._({id:"3Bbgw2"}),icon:n.jsx(cn,{}),tooltip:t._({id:"utafdp"}),ChildItem:$n}),oe({hidden:u||!i||!o,mdl_prop:f,title:t._({id:"ut1J8k"}),icon:n.jsx(dn,{}),tooltip:t._({id:"AlfG1i"}),ChildItem:Jn}),...c]})}function oe({hidden:s=!1,mdl_prop:e,title:i,icon:c,tooltip:o,ChildItem:u}){return{icon:c,name:i,tooltip:o,onClick:()=>{Ln.open({title:n.jsx(Ve,{size:"xl",children:i}),children:n.jsx(u,{mdl_prop:e})})},hidden:s}}function kt(s){return{...s,icon:n.jsx(De,{color:"blue"}),name:t._({id:"ePK91l"}),tooltip:s.tooltip??t._({id:"Qpg4KV"})}}function wt(s){return{...s,icon:n.jsx(pe,{color:"red"}),name:t._({id:"cnGeoo"}),tooltip:s.tooltip??t._({id:"ZatbPe"})}}function Tt(s){return{...s,icon:n.jsx(Ne,{icon:"hold",iconProps:{color:"orange"}}),name:t._({id:"YJMNeo"}),tooltip:s.tooltip??t._({id:"YJMNeo"})}}function At(s){return{...s,icon:n.jsx(Ne,{icon:"cancel",iconProps:{color:"red"}}),name:t._({id:"dEgA5A"}),tooltip:s.tooltip??t._({id:"dEgA5A"})}}function vt(s){return{...s,icon:n.jsx(Be,{color:"green"}),name:t._({id:"euc6Ns"}),tooltip:s.tooltip??t._({id:"QXHPgY"})}}function Xn({items:s,hidden:e,enableLabels:i,enableReports:c,modelType:o}){const u=Ue(),f=ge(),m=r.useMemo(()=>s.length>0,[s]),[x,l]=r.useState(""),p=r.useMemo(()=>i&&f.isSet("LABEL_ENABLE"),[i,f]),k=r.useMemo(()=>c&&f.isSet("REPORT_ENABLE"),[c,f]),[I,_]=r.useState(void 0),[b,w]=r.useState(void 0);fe({title:t._({id:"5cY8gX"}),id:I}),fe({title:t._({id:"T6GYw9"}),id:b});const v=Q({enabled:p,queryKey:["printingFields",o,x],gcTime:500,queryFn:()=>Sn.options(D(B.label_print),{params:{plugin:x||void 0}}).then(C=>xe(C,"POST")||{})}),H=r.useMemo(()=>{const C=v.data||{};return C.template={...C.template,autoFill:!0,filters:{enabled:!0,model_type:o,items:s.join(",")}},C.items={...C.items,value:s,hidden:!0},C.plugin={...C.plugin,value:u.getSetting("LABEL_DEFAULT_PRINTER"),filters:{active:!0,mixin:"labels"},onValueChange:(y,M)=>{M!=null&&M.key&&(M==null?void 0:M.key)!=x&&l(M.key)}},C},[v.data,s]),L=me({url:D(B.label_print),title:t._({id:"kjqRDg"}),fields:H,timeout:5e3,onClose:()=>{l("")},submitText:t._({id:"BZz12Q"}),successMessage:null,onFormSuccess:C=>{l(""),_(C.pk)}}),F=me({title:t._({id:"qsurSb"}),url:D(B.report_print),timeout:5e3,fields:{template:{autoFill:!0,filters:{enabled:!0,model_type:o,items:s.join(",")}},items:{hidden:!0,value:s}},submitText:t._({id:"BZz12Q"}),successMessage:null,onFormSuccess:C=>{w(C.pk)}});return!o||!p&&!k?null:!e&&n.jsxs(n.Fragment,{children:[F.modal,L.modal,n.jsx(_e,{tooltip:t._({id:"/oz6DG"}),icon:n.jsx(fn,{}),disabled:!m,actions:[{name:t._({id:"Y93N6T"}),icon:n.jsx(un,{}),onClick:()=>L.open(),hidden:!p},{name:t._({id:"ClULGR"}),icon:n.jsx(mn,{}),onClick:()=>F.open(),hidden:!k}]})]})}function It(s){return{...s,color:void 0,icon:n.jsx(Le,{}),onClick:e=>{const i=ae(s.modelType,s.modelId);ce(i,s.navigate,e)}}}function Rt(s){return{...s,title:t._({id:"euc6Ns"}),color:"green",icon:n.jsx(Be,{})}}function Et(s){return{...s,title:t._({id:"ePK91l"}),color:"blue",icon:n.jsx(De,{})}}function Mt(s){return{...s,title:t._({id:"cnGeoo"}),color:"red",icon:n.jsx(pe,{})}}function St(s){return{...s,title:t._({id:"dEgA5A"}),color:"red",icon:n.jsx(hn,{})}}function Wn({title:s,actions:e,disabled:i=!1,index:c}){function o(l){ne(l),f(!u)}const[u,f]=r.useState(!1),m=r.useMemo(()=>e.filter(l=>!l.hidden),[e]);function x(l){return n.jsx(O,{withinPortal:!0,label:l.tooltip??l.title,position:"left",children:n.jsx(A.Item,{color:l.color,leftSection:l.icon,onClick:p=>{var k;ne(p),(k=l.onClick)==null||k.call(l,p),f(!1)},disabled:l.disabled||!1,children:l.title})},l.title)}return m.length>0&&n.jsxs(A,{withinPortal:!0,disabled:i,position:"bottom-end",opened:u,onChange:f,children:[n.jsx(A.Target,{children:n.jsx(O,{withinPortal:!0,label:s||t._({id:"7L01XJ"}),children:n.jsx(z,{"aria-label":`row-action-menu-${c??""}`,onClick:o,disabled:i,variant:"subtle",color:"gray",children:n.jsx(pn,{})},`row-action-menu-${c??""}`)})}),n.jsx(A.Dropdown,{children:m.map(l=>n.jsx(x,{...l},l.title))})]})}function Zn(s){const[e,i]=gn({key:`inventree-filterset-${s}`,defaultValue:[],sync:!1,getInitialValueInEffect:!1}),c=r.useCallback(()=>{i([])},[]);return{filterKey:s,activeFilters:e,setActiveFilters:i,clearActiveFilters:c}}function Dt(s,e="pk"){function i(){return`${s.replaceAll("-","")}-${xn()}`}const[c,o]=En(),u=r.useCallback(()=>{o({})},[]),[f,m]=r.useState(i()),x=r.useCallback(R=>{m(i()),R&&L()},[i]),l=Zn(`table-${s}`),[p,k]=r.useState([]),I=r.useCallback(R=>p.includes(R),[p]),[_,b]=r.useState([]),[w,v]=r.useState([]),H=r.useMemo(()=>w.map(R=>R[e||"pk"]),[w]),L=r.useCallback(()=>{v([])},[]),F=r.useMemo(()=>w.length>0,[w]),[C,y]=r.useState(0),[M,g]=r.useState(1),[U,J]=r.useState(""),[V,X]=r.useState([]),q=r.useCallback(R=>{const E=[...V],N=E.findIndex(se=>se[e||"pk"]===R.pk);N>=0?E[N]={...E[N],...R}:E.push(R),X(E)},[V]),[te,G]=r.useState(!1);return{tableKey:f,refreshTable:x,isLoading:te,setIsLoading:G,filterSet:l,queryFilters:c,setQueryFilters:o,clearQueryFilters:u,expandedRecords:p,setExpandedRecords:k,isRowExpanded:I,selectedRecords:w,selectedIds:H,setSelectedRecords:v,clearSelectedRecords:L,hasSelectedRecords:F,searchTerm:U,setSearchTerm:J,recordCount:C,setRecordCount:y,hiddenColumns:_,setHiddenColumns:b,page:M,setPage:g,records:V,setRecords:X,updateRecord:q,idAccessor:e}}function et({icon:s,actions:e,tooltip:i="",label:c=""}){return n.jsxs(A,{shadow:"xs",children:[n.jsx(A.Target,{children:n.jsx(z,{variant:"default",children:n.jsx(O,{label:i,children:s})})}),n.jsxs(A.Dropdown,{children:[c&&n.jsx(A.Label,{children:c}),e.map((o,u)=>n.jsx(A.Item,{children:o},`${u}-${o}`))]})]})}function nt({disabled:s,debounce:e,placeholder:i,searchCallback:c}){const[o,u]=r.useState(""),[f]=_n(o,e??500);return r.useEffect(()=>{c(f)},[f]),n.jsx(Oe,{value:o,disabled:s,"aria-label":"table-search-input",leftSection:n.jsx(Cn,{}),placeholder:i??t._({id:"A1taO8"}),onChange:m=>u(m.target.value),rightSection:o.length>0?n.jsx(He,{size:"xs",onClick:()=>{u(""),c("")}}):null})}function tt({url:s,enabled:e,filters:i,searchTerm:c}){const o=he(),[u,f]=r.useState("inventree-exporter"),[m,x]=r.useState(void 0);fe({title:t._({id:"gAwkCm"}),id:m});const l=r.useMemo(()=>{const _={export:!0};u&&(_.export_plugin=u);for(const[b,w]of Object.entries(i??{}))w!=null&&(_[b]=w);return c&&(_.search=c),_},[u,i,c]),p=Q({enabled:!!s&&e,queryKey:["export-fields",u,s,l],gcTime:500,queryFn:()=>o.options(s,{params:l}).then(_=>xe(_,"GET")||{})}),k=r.useMemo(()=>{const _=p.data||{},b={export_format:{},export_plugin:{},..._};return b.export_format={...b.export_format,required:!0},b.export_plugin={...b.export_plugin,required:!0,onValueChange:w=>{w&&f(w)}},b},[p]);return me({url:s,queryParams:new URLSearchParams(l),title:t._({id:"CEVW38"}),method:"GET",fields:k,submitText:t._({id:"GS+Mus"}),successMessage:null,timeout:30*1e3,onFormSuccess:_=>{x(_.pk),f("inventree-exporter")}})}function st({columns:s,onToggleColumn:e}){return n.jsxs(A,{shadow:"xs",closeOnItemClick:!1,children:[n.jsx(A.Target,{children:n.jsx(z,{variant:"transparent","aria-label":"table-select-columns",children:n.jsx(O,{label:t._({id:"kCTFU8"}),position:"top-end",children:n.jsx(jn,{})})})}),n.jsxs(A.Dropdown,{style:{maxHeight:"400px",overflowY:"auto"},children:[n.jsx(A.Label,{children:t._({id:"kCTFU8"})}),n.jsx(qe,{}),s.filter(i=>i.switchable??!0).map(i=>n.jsx(A.Item,{children:n.jsx(bn,{checked:!i.hidden,label:i.title||i.accessor,onChange:()=>e(i.accessor),radius:"sm"})},i.accessor))]})]})}function it(s){return s.choices?s.choices:s.choiceFunction?s.choiceFunction():[{value:"true",label:t._({id:"l75CjT"})},{value:"false",label:t._({id:"1UzENP"})}]}function rt(s){return()=>{const e=Dn.getState().status;if(!e)return[];const i=e[s];return i?Object.keys(i.values).map(c=>{var u;const o=i.values[c];return{value:o.key.toString(),label:((u=o.label)==null?void 0:u.toString())??o.key.toString()}}):[]}}function Bt(){return{name:"has_batch",label:t._({id:"qPCbMt"}),description:t._({id:"rc/Y1E"})}}function Lt(){return{name:"batch",label:t._({id:"Vea6Aj"}),description:t._({id:"Y/SfF6"}),type:"text"}}function Ot(){return{name:"serialized",label:t._({id:"SkCY/+"}),description:t._({id:"S5yS1f"})}}function Ht(){return{name:"serial",label:t._({id:"ypfsn/"}),description:t._({id:"hFRTeN"}),type:"text"}}function qt(){return{name:"serial_lte",label:t._({id:"sQUbHe"}),description:t._({id:"yLzTzA"}),type:"text"}}function zt(){return{name:"serial_gte",label:t._({id:"TiS4AP"}),description:t._({id:"Gnj5CL"}),type:"text"}}function Pt(){return{name:"assigned_to_me",type:"boolean",label:t._({id:"iU3XRS"}),description:t._({id:"BnF3ID"})}}function Ut(){return{name:"outstanding",label:t._({id:"aimnwe"}),description:t._({id:"5Dr8AX"})}}function Nt(){return{name:"overdue",label:t._({id:"ddrz1m"}),description:t._({id:"eoAfY+"})}}function Vt(){return{name:"min_date",label:t._({id:"vhCfRp"}),description:t._({id:"g6o1nx"}),type:"date"}}function Gt(){return{name:"max_date",label:t._({id:"dogwLN"}),description:t._({id:"/Is0Q9"}),type:"date"}}function Kt(){return{name:"created_before",label:t._({id:"XIK9k0"}),description:t._({id:"BVOUXI"}),type:"date"}}function Yt(){return{name:"created_after",label:t._({id:"pQfuT0"}),description:t._({id:"5D7LoD"}),type:"date"}}function Qt(){return{name:"start_date_before",label:t._({id:"MpyljM"}),description:t._({id:"YgY+H6"}),type:"date"}}function $t(){return{name:"start_date_after",label:t._({id:"8IA8ke"}),description:t._({id:"5gLRm5"}),type:"date"}}function Jt(){return{name:"target_date_before",label:t._({id:"SsUIID"}),description:t._({id:"Ey6gw7"}),type:"date"}}function Xt(){return{name:"target_date_after",label:t._({id:"a8vo2j"}),description:t._({id:"wvwgPk"}),type:"date"}}function Wt(){return{name:"completed_before",label:t._({id:"7Ul+eL"}),description:t._({id:"qR6hn8"}),type:"date"}}function Zt(){return{name:"completed_after",label:t._({id:"cFFv89"}),description:t._({id:"liohcD"}),type:"date"}}function es(){const e=ge.getState().isSet("PROJECT_CODES_ENABLED",!0);return{name:"has_project_code",type:"boolean",label:t._({id:"e7gdBS"}),description:t._({id:"gW+vYR"}),active:e}}function ns(){return{name:"include_variants",type:"boolean",label:t._({id:"/g9i/Z"}),description:t._({id:"yDiGmv"})}}function ts({model:s}){return{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"OIH7WF"}),choiceFunction:rt(s)}}function ss(){const e=ge.getState().isSet("PROJECT_CODES_ENABLED",!0);return{name:"project_code",label:t._({id:"Sdfr6G"}),description:t._({id:"8sHFLc"}),active:e,type:"api",apiUrl:D(B.project_code_list),model:P.projectcode,modelRenderer:i=>i.code}}function ot({name:s,label:e,description:i}){return{name:s,label:e,description:i,type:"api",apiUrl:D(B.owner_list),model:P.owner,modelRenderer:c=>c.name}}function is(){return ot({name:"assigned_to",label:t._({id:"XQACoK"}),description:t._({id:"OVVPn5"})})}function Ge({name:s,label:e,description:i}){return{name:s??"user",label:e??t._({id:"7PzzBU"}),description:i??t._({id:"FVjW63"}),type:"api",apiUrl:D(B.user_list),model:P.user,modelRenderer:c=>c.username}}function rs(){return{name:"manufacturer",label:t._({id:"+m9/3S"}),description:t._({id:"ZbKIR3"}),type:"api",apiUrl:D(B.company_list),model:P.company,modelRenderer:s=>s.name,apiFilter:{is_manufacturer:!0}}}function os(){return{name:"supplier",label:t._({id:"PYTEl0"}),description:t._({id:"L+0p0h"}),type:"api",apiUrl:D(B.company_list),model:P.company,modelRenderer:s=>s.name,apiFilter:{is_supplier:!0}}}function ls(){return Ge({name:"created_by",label:t._({id:"egTba/"}),description:t._({id:"cX/tzW"})})}function as(){return Ge({name:"issued_by",label:t._({id:"kmUN8p"}),description:t._({id:"QFznVK"})})}function cs(){return{name:"category",label:t._({id:"QXANxH"}),description:t._({id:"/zwgG7"}),apiUrl:D(B.category_list),model:P.partcategory,modelRenderer:s=>s.name}}function ds(){return{name:"location",label:t._({id:"wJijgU"}),description:t._({id:"Bp02Dg"}),apiUrl:D(B.stock_location_list),model:P.stocklocation,modelRenderer:s=>s.name}}function lt({flt:s,filterSet:e}){const i=r.useCallback(()=>{const c=e.activeFilters.filter(o=>o.name!==s.name);e.setActiveFilters(c)},[s]);return n.jsx(Fn,{p:"sm",shadow:"sm",radius:"xs",children:n.jsxs(Y,{justify:"space-between",wrap:"nowrap",children:[n.jsxs($,{gap:"xs",children:[n.jsx(K,{size:"sm",children:s.label}),n.jsx(K,{size:"xs",children:s.description})]}),n.jsxs(Y,{justify:"right",children:[n.jsx(kn,{children:s.displayValue??s.value}),n.jsx(O,{label:t._({id:"rn2/2V"}),withinPortal:!0,children:n.jsx(He,{size:"md",color:"red",onClick:i})})]})]},s.name)})}function at({filterName:s,filterProps:e,valueOptions:i,onValueChange:c}){const o=r.useCallback(m=>{if(m){const x=m.toString();c(Un(x).format("YYYY-MM-DD"))}else c("")},[c]),[u,f]=r.useState("");switch(e.type){case"api":return n.jsx(Vn,{fieldName:`filter-${s}`,fieldDefinition:{field_type:"related field",api_url:e.apiUrl,filters:e.apiFilter,placeholder:t._({id:"Fo55lj"}),model:e.model,label:t._({id:"Fo55lj"}),onValueChange:(m,x)=>{var l;c(m,(l=e.modelRenderer)==null?void 0:l.call(e,x))}}});case"text":return n.jsx(Oe,{label:t._({id:"wMHvYH"}),value:u,placeholder:t._({id:"Q//Mlp"}),rightSection:n.jsx(z,{"aria-label":"apply-text-filter",variant:"transparent",onClick:()=>c(u),children:n.jsx(wn,{})}),onChange:m=>f(m.currentTarget.value),onKeyDown:m=>{m.key==="Enter"&&c(u)}});case"date":return n.jsx(Nn,{label:t._({id:"wMHvYH"}),placeholder:t._({id:"A63fc7"}),onChange:o});case"choice":case"boolean":default:return n.jsx(Pe,{data:i,searchable:e.type=="choice",label:t._({id:"wMHvYH"}),withScrollArea:!1,placeholder:t._({id:"Fo55lj"}),onChange:m=>c(m),maxDropdownHeight:800})}}function ct({filterSet:s,availableFilters:e}){const i=r.useMemo(()=>{var p,k,I;let l=[];return s.activeFilters&&s.activeFilters.length>0&&(l=((p=s.activeFilters)==null?void 0:p.map(_=>_.name))??[]),((I=(k=e==null?void 0:e.filter(_=>!l.includes(_.name)))==null?void 0:k.sort((_,b)=>_.label.localeCompare(b.label)))==null?void 0:I.map(_=>({value:_.name,label:_.label,description:_.description})))??[]},[s.activeFilters,e]),[c,o]=r.useState(null),u=r.useMemo(()=>{const l=e==null?void 0:e.find(p=>p.name===c);return l?it(l):[]},[c]),f=l=>l.type?l.type:l.apiUrl&&l.model?"api":l.choices||l.choiceFunction?"choice":"boolean",m=r.useMemo(()=>{const l=e==null?void 0:e.find(p=>p.name===c);return l&&(l.type=f(l)),l},[e,c]),x=r.useCallback((l,p)=>{var b,w;const k=e.find(v=>v.name===c);if(!k)return;const I=((b=s.activeFilters)==null?void 0:b.filter(v=>v.name!==c))??[],_={...k,value:l,displayValue:p??((w=u.find(v=>v.value===l))==null?void 0:w.label)};s.setActiveFilters([...I,_]),o(null)},[c]);return n.jsxs($,{gap:"xs",children:[n.jsx(Pe,{data:i,searchable:!0,placeholder:t._({id:"hpMOSe"}),label:t._({id:"o7J4JM"}),onChange:l=>o(l),maxDropdownHeight:400}),c&&m&&n.jsx(at,{filterName:c,filterProps:m,valueOptions:u,onValueChange:x})]})}function dt({title:s,availableFilters:e,filterSet:i,opened:c,onClose:o}){var x;const[u,f]=r.useState(!1);r.useEffect(()=>{f(!1)},[i.activeFilters]);const m=r.useMemo(()=>((i==null?void 0:i.activeFilters)??[]).length>0,[i.activeFilters]);return n.jsxs(yn,{size:"sm",position:"right",withCloseButton:!0,opened:c,onClose:o,closeButtonProps:{"aria-label":"filter-drawer-close"},title:n.jsx(Ve,{size:"lg",children:s??t._({id:"l34cnu"})}),children:[n.jsx(qe,{}),n.jsx(ze,{h:"sm"}),n.jsxs($,{gap:"xs",children:[m&&((x=i.activeFilters)==null?void 0:x.map(l=>n.jsx(lt,{flt:l,filterSet:i},l.name))),u&&n.jsx($,{gap:"xs",children:n.jsx(ct,{filterSet:i,availableFilters:e})}),u&&n.jsx(ee,{onClick:()=>f(!1),color:"orange",variant:"subtle",children:n.jsx(K,{children:t._({id:"dEgA5A"})})}),!u&&i.activeFilters.length<e.length&&n.jsx(ee,{onClick:()=>f(!0),color:"green",variant:"subtle",children:n.jsx(K,{children:t._({id:"PzFzS+"})})}),!u&&i.activeFilters.length>0&&n.jsx(ee,{onClick:i.clearActiveFilters,color:"red",variant:"subtle",children:n.jsx(K,{children:t._({id:"J8ECgX"})})})]})]})}function ut({tableUrl:s,tableState:e,tableProps:i,hasSwitchableColumns:c,columns:o,filters:u,toggleColumn:f}){var w,v,H,L;const[m,x]=r.useState(!1),l=r.useMemo(()=>{const F={};for(const[C,y]of Object.entries(i.params??{}))y!=null&&(F[C]=y);if(e.filterSet.activeFilters&&e.filterSet.activeFilters.forEach(C=>{F[C.name]=C.value}),e.queryFilters)for(const[C,y]of e.queryFilters)y!=null&&(F[C]=y);return F},[i.params,e.filterSet,e.queryFilters]),p=tt({url:s??"",enabled:!!s&&(i==null?void 0:i.enableDownload)!=!1,filters:l,searchTerm:e.searchTerm}),k=Gn({url:s??"",title:t._({id:"NEGzXb"}),preFormContent:n.jsx(Ae,{color:"red",title:t._({id:"3kYcuM"}),children:t._({id:"U99rVM"})}),initialData:{items:e.selectedIds},fields:{items:{hidden:!0}},successMessage:t._({id:"B7s1hd"}),onFormError:F=>{Me({id:"bulk-delete-error",title:t._({id:"SlfejT"}),message:t._({id:"NO2Qmx"}),color:"red",icon:n.jsx(Se,{}),autoClose:5e3})},onFormSuccess:()=>{e.clearSelectedRecords(),e.refreshTable(),i.afterBulkDelete&&i.afterBulkDelete()}}),I=r.useMemo(()=>e.queryFilters.has("search"),[e.queryFilters]),_=r.useMemo(()=>{var F;return(((F=e==null?void 0:e.queryFilters)==null?void 0:F.size)??0)>0},[e.queryFilters]),b=r.useMemo(()=>{var F;return((F=e.selectedRecords)==null?void 0:F.map(C=>de(C,i.printingAccessor??"pk")))??[]},[i.printingAccessor,e.selectedRecords]);return n.jsxs(n.Fragment,{children:[p.modal,k.modal,i.enableFilters&&(u.length??0)>0&&n.jsx(ue,{label:`InvenTreeTableFilterDrawer-${e.tableKey}`,children:n.jsx(dt,{availableFilters:u,filterSet:e.filterSet,opened:m,onClose:()=>x(!1)})}),(_||I)&&n.jsx(Ae,{color:"yellow",withCloseButton:!0,title:t._({id:"VUTcDq"}),onClose:()=>e.clearQueryFilters()}),n.jsxs(Y,{justify:"apart",grow:!0,wrap:"nowrap",children:[n.jsxs(Y,{justify:"left",gap:5,wrap:"nowrap",children:[n.jsx(Xn,{items:b,modelType:i.modelType,enableLabels:i.enableLabels,enableReports:i.enableReports}),(((w=i.barcodeActions)==null?void 0:w.length)??0)>0&&n.jsx(et,{icon:n.jsx(Tn,{}),label:t._({id:"heU0Hk"}),tooltip:t._({id:"heU0Hk"}),actions:i.barcodeActions??[]},"barcode-actions"),i.enableBulkDelete&&n.jsx(Yn,{disabled:!e.hasSelectedRecords,icon:n.jsx(pe,{}),color:"red",tooltip:t._({id:"QZQ+5V"}),onClick:()=>{k.open()}}),(v=i.tableActions)==null?void 0:v.map((F,C)=>n.jsx(n.Fragment,{children:F},C))]},"custom-actions"),n.jsx(ze,{}),n.jsxs(Y,{justify:"right",gap:5,wrap:"nowrap",children:[i.enableSearch&&n.jsx(nt,{disabled:I,searchCallback:F=>e.setSearchTerm(F)}),i.enableRefresh&&n.jsx(z,{variant:"transparent","aria-label":"table-refresh",children:n.jsx(O,{label:t._({id:"8RYNR1"}),position:"top-end",children:n.jsx(An,{onClick:()=>{e.refreshTable(),e.clearSelectedRecords()}})})}),c&&n.jsx(st,{columns:o,onToggleColumn:f}),i.enableFilters&&u.length>0&&n.jsx(le,{size:"xs",label:((H=e.filterSet.activeFilters)==null?void 0:H.length)??0,disabled:((L=e.filterSet.activeFilters)==null?void 0:L.length)==0,children:n.jsx(z,{disabled:_,variant:"transparent","aria-label":"table-select-filters",children:n.jsx(O,{label:t._({id:"l34cnu"}),position:"top-end",children:n.jsx(vn,{onClick:()=>x(!m)})})})}),s&&i.enableDownload&&n.jsx(z,{variant:"transparent","aria-label":"table-export-data",children:n.jsx(O,{label:t._({id:"ECXmiK"}),position:"top-end",children:n.jsx(In,{onClick:p.open})})})]})]})]})}const Ee="--actions--",mt=[10,15,20,25,50,100,500],ft={params:{},noRecordsText:t._({id:"EqGTpW"}),enableDownload:!1,enableLabels:!1,enableReports:!1,enableFilters:!0,enablePagination:!0,enableRefresh:!0,enableSearch:!0,enableSelection:!1,defaultSortColumn:"",barcodeActions:[],printingAccessor:"pk",tableFilters:[],tableActions:[]};function us({url:s,tableState:e,tableData:i,columns:c,props:o}){const{userTheme:u}=Bn(),{pageSize:f,setPageSize:m,getHiddenColumns:x,setHiddenColumns:l,getTableColumnNames:p,setTableColumnNames:k,getTableSorting:I,setTableSorting:_}=On(),[b,w]=r.useState({}),v=he(),H=Hn(),{showContextMenu:L}=qn(),F=Ue(),C=r.useMemo(()=>F.isSet("STICKY_TABLE_HEADER"),[F]),y=r.useMemo(()=>{const a=`table-${e.tableKey}`,d=a.indexOf("-mantine");return d>=0?a.substring(0,d):a},[e.tableKey]),M=r.useMemo(()=>{var a,d;return((d=(a=o.tableFilters)==null?void 0:a.filter(h=>h.active!=!1))==null?void 0:d.map(h=>({...h,label:h.label??b[h.name]??`${h.name}`})))??[]},[o.tableFilters,b]),g=r.useMemo(()=>({...ft,...o}),[o]),U=Q({enabled:!!s&&!i,queryKey:["options",s,y,g.params,o.enableColumnCaching],retry:5,retryDelay:a=>(1+a)*250,throwOnError:a=>(Ie({error:a,title:t._({id:"0uyCkG"})}),!0),refetchOnMount:!0,gcTime:5e3,queryFn:async()=>!s||o.enableColumnCaching==!1||b&&Object.keys(b).length>0?null:v.options(s,{params:g.params}).then(a=>{if(a.status==200){const d={},h=xe(a,"GET",!0)||{};Kn(h,(j,T)=>{T.label&&(d[j]=T.label)}),w(d),k(y)(d)}return null})});r.useEffect(()=>{if(o.enableColumnCaching==!1)return;const a=p(y);if(a!=null){w(a);return}},[]);const J=r.useMemo(()=>g.enableSelection||g.enableBulkDelete||!1,[g]),V=r.useMemo(()=>o.enableColumnSwitching==!1?!1:c.some(a=>a.hidden==!0?!1:a.switchable!=!1),[c,o.enableColumnSwitching]),X=r.useCallback(a=>{e.setSelectedRecords(a)},[e.setSelectedRecords]),q=r.useMemo(()=>{let a=c.filter(d=>(d==null?void 0:d.hidden)!=!0);return a=a.map(d=>{var j;const h=d.switchable==!1?!1:((j=e.hiddenColumns)==null?void 0:j.includes(d.accessor))??!1;return{...d,hidden:h,resizable:d.resizable??!0,title:d.title??b[d.accessor]??`${d.accessor}`}}),g.rowActions&&a.push({accessor:Ee,title:"   ",hidden:!1,resizable:!1,switchable:!1,width:50,render:(d,h)=>{var j;return n.jsx(Wn,{actions:((j=g.rowActions)==null?void 0:j.call(g,d))??[],disabled:e.selectedRecords.length>0,index:h})}}),a},[c,b,g.rowActions,e.hiddenColumns,e.selectedRecords]),te=r.useCallback(a=>{const d=[...q],h=d.findIndex(T=>T.accessor==a);h>=0&&h<d.length&&(d[h].hidden=!d[h].hidden);const j=d.filter(T=>T.hidden).map(T=>T.accessor);e.setHiddenColumns(j),l(y)(j)},[y,q]),G=zn({key:y,columns:q,getInitialValueInEffect:!1}),R=r.useMemo(()=>q.map(a=>a.accessor),[q]);r.useEffect(()=>{JSON.stringify(G.columnsOrder)!=JSON.stringify(R)&&G.setColumnsOrder(R)},[y,R]),r.useEffect(()=>{e.setPage(1)},[e.searchTerm]);const[E,N]=r.useState({columnAccessor:g.defaultSortColumn??"",direction:"asc"}),se=r.useCallback((a=!1)=>{const d={...g.params};if(e.queryFilters&&e.queryFilters.size>0)for(const[j,T]of e.queryFilters)d[j]=T;else e.filterSet.activeFilters&&e.filterSet.activeFilters.forEach(j=>{d[j.name]=j.value});e.searchTerm&&(d.search=e.searchTerm),g.enablePagination&&a&&(d.limit=f,d.offset=(e.page-1)*f);const h=je();return h&&(E.direction=="asc"?d.ordering=h:d.ordering=`-${h}`),d},[E,g.params,g.enablePagination,e.filterSet.activeFilters,e.queryFilters,e.searchTerm,je]),[Ce,Ke]=r.useState(!1);r.useEffect(()=>{const a=I(y);a&&a.columnAccessor&&a.direction&&N(a);const d=x(y);if(d==null){const h=c.filter(j=>j.switchable!=!1&&j.defaultVisible==!1).map(j=>j.accessor);l(y)(h),e.setHiddenColumns(h)}else e.setHiddenColumns(d);Ke(!0)},[y]);function je(){const a=E.columnAccessor;if(a=="")return"";const d=q.find(h=>h.accessor==a);return(d==null?void 0:d.ordering)||a}const[Ye,Qe]=r.useState(g.noRecordsText??t._({id:"EqGTpW"})),$e=r.useCallback(a=>{e.setPage(1),N(a),_(y)(a)},[y]),Je=async()=>{const a=se(!0);return s?Ce?v.get(s,{params:a,timeout:10*1e3}).then(d=>{var j,T;let h=((j=d.data)==null?void 0:j.results)??d.data??[];return o.dataFormatter&&(h=o.dataFormatter(h)),Array.isArray(h)||(Qe(t._({id:"3o3AAs"})),h=[]),e.setRecordCount(((T=d.data)==null?void 0:T.count)??h.length),h}):[]:[]},{data:be,isFetching:ie,isLoading:ye,refetch:Xe}=Q({queryKey:["tabledata",s,e.page,o.params,Ce,E.columnAccessor,E.direction,e.tableKey,e.filterSet.activeFilters,e.searchTerm],retry:5,retryDelay:a=>(1+a)*250,throwOnError:a=>(Ie({error:a,title:t._({id:"UJqwtM"})}),!0),enabled:!!s&&!i,queryFn:Je});r.useEffect(()=>{Xe()},[e.queryFilters]),r.useEffect(()=>{const a=ie||ye||U.isFetching||U.isLoading;a!=e.isLoading&&e.setIsLoading(a)},[ie,ye,U.isFetching,U.isLoading,e.isLoading]);const Fe=r.useMemo(()=>g.enablePagination!=!1?f:e.recordCount,[g.enablePagination,f,e.recordCount]);r.useEffect(()=>{e.setRecords(i??be??[])},[i,be]);const We=r.useCallback(({event:a,record:d,index:h,column:j,columnIndex:T})=>{if(j.accessor!=Ee){if(o.onCellClick)o.onCellClick({event:a,record:d,index:h,column:j,columnIndex:T});else if(o.onRowClick)o.onRowClick(d,h,a);else if(g.modelType){const S=g.modelField??"pk",W=de(d,S);if(W){ne(a);const re=ae(g.modelType,W);ce(re,H,a)}}}},[o.onRowClick,o.onCellClick]),Ze=r.useMemo(()=>!!o.onCellContextMenu||!!o.rowActions||!!o.modelType,[o.onCellContextMenu,o.rowActions,o.modelType]),en=({record:a,column:d,event:h})=>{if((d==null?void 0:d.noContext)===!0)return;if(o.onCellContextMenu)return o.onCellContextMenu(a,h);const j=()=>{};let T=[];if(o.rowActions&&(T=o.rowActions(a).map(S=>({key:S.title??"",title:S.title??"",color:S.color,icon:S.icon,onClick:S.onClick??j,hidden:S.hidden,disabled:S.disabled}))),o.modelType){const S=o.modelField??"pk",W=de(a,S),re=ae(o.modelType,W);T.push({key:"detail",title:t._({id:"2Eoi/a"}),icon:n.jsx(Le,{}),onClick:we=>{ne(we),ce(re,H,we)}})}return L(T)(h)},ke=r.useCallback(a=>{m(a),e.setPage(1),e.refreshTable()},[]),nn=r.useMemo(()=>{if(o.rowExpansion)return{...o.rowExpansion,expanded:{recordIds:e.expandedRecords,onRecordIdsChange:a=>{e.setExpandedRecords(a)}}}},[e.expandedRecords,e.setExpandedRecords,o.rowExpansion]),tn=r.useMemo(()=>{let a={};return g.enablePagination&&(a={...a,totalRecords:e.recordCount,recordsPerPage:Fe,page:e.page,onPageChange:e.setPage,recordsPerPageOptions:mt,onRecordsPerPageChange:ke}),a},[Fe,g.enablePagination,e.recordCount,e.page,e.setPage,ke]),sn=r.useMemo(()=>!!(g.onCellClick||g.onRowClick||g.modelType),[g.onCellClick,g.onRowClick,g.modelType]);return n.jsx(n.Fragment,{children:n.jsxs($,{gap:"xs",children:[!g.noHeader&&n.jsx(ue,{label:`InvenTreeTableHeader-${y}`,children:n.jsx(ut,{tableUrl:s,tableState:e,tableProps:g,hasSwitchableColumns:V,columns:q,filters:M,toggleColumn:te})}),n.jsx(ue,{label:`InvenTreeTable-${y}`,children:n.jsx(Rn,{pos:"relative",children:n.jsx(Pn,{style:{stickyHeader:C?"top":void 0},height:C?"80vh":void 0,withTableBorder:!g.noHeader,withColumnBorders:!0,striped:!0,highlightOnHover:!0,loaderType:u.loader,pinLastColumn:g.rowActions!=null,idAccessor:e.idAccessor??"pk",minHeight:g.minHeight??300,sortStatus:E,onSortStatusChange:$e,selectedRecords:J?e.selectedRecords:void 0,onSelectedRecordsChange:J?X:void 0,rowExpansion:nn,fetching:ie,noRecordsText:Ye,records:e.records,storeColumnsKey:y,columns:G.effectiveColumns,onCellClick:sn?We:void 0,noHeader:g.noHeader??!1,defaultColumnProps:{textAlign:"left"},onCellContextMenu:Ze?en:void 0,...tn})})})]})})}export{_e as A,Ft as B,At as C,wt as D,kt as E,ss as F,es as G,Bt as H,us as I,is as J,ls as K,Rt as L,Vt as M,os as N,yt as O,Xn as P,rs as Q,Et as R,rt as S,Jt as T,Ge as U,Zn as V,tt as W,dt as X,nt as Y,St as Z,as as _,Mt as a,vt as b,cs as c,ns as d,It as e,Wn as f,ds as g,Lt as h,Ot as i,Ht as j,qt as k,zt as l,Tt as m,ts as n,Ut as o,Nt as p,Pt as q,Gt as r,Kt as s,Yt as t,Dt as u,Xt as v,Qt as w,$t as x,Wt as y,Zt as z};
//# sourceMappingURL=InvenTreeTable-CvoMTeKF.js.map
