import{r as i,i as t,j as o,G as B,cw as W,B as z,bx as q,ah as G,b9 as L,S as J}from"./vendor-DM3YzW4g.js";import{b as N,m as n,e as y,A as c,U as u,h as M,a as v}from"./index-D337eai7.js";import{I as A,n as K,a as X,p as E}from"./ThemeContext-Ch4E8_Wm.js";import{A as Y}from"./AdminButton-DDvP9DUk.js";import{u as Z,A as H,R as $,I as ee,B as te,P as oe,O as se,E as ae,D as ne}from"./InvenTreeTable-Dtz5z1-X.js";import{I as ie,D as F,a as ce}from"./InstanceDetail-DA14-H9g.js";import{c as g,u as le,a as O,d as re,A as de,b as pe}from"./UseForm-TWh6_feP.js";import{N as me}from"./NavigationTree-BckOClxH.js";import{P as ue}from"./PageDetail-Dn7pSuNG.js";import{P as _e}from"./PanelGroup-CoO7I8l_.js";import{L as ke}from"./LocateItemButton-CPYc9fAm.js";import{s as T,u as be}from"./UseStockAdjustActions-CeS3J9s3.js";import{u as he}from"./UseInstance-DbwM5beB.js";import{P as xe}from"./PartTable-ChX5Vxac.js";import{S as fe}from"./StockItemTable-CIOZiwZe.js";import{D as je,B as w}from"./ColumnRenderers-B1TW1pd2.js";import"./ActionButton-Q09YVtCx.js";import"./DesktopAppView-DyVa6oYc.js";import"./index-BOcT9Srm.js";import"./QRCode-C5FiSMEd.js";import"./browser-BJvvAuRs.js";import"./YesNoButton-DTVLZZ3k.js";import"./formatters-DcPgPpLg.js";import"./ModelType-B9P_b1nX.js";import"./GenericErrorPage-D_bi0_m-.js";import"./NotFound-DAIe8IKA.js";import"./PermissionDenied-BwuEjXQw.js";import"./PageTitle-vGWzRKl1.js";import"./PluginSource-BculEAAL.js";import"./RemoteComponent-YA1xDtB_.js";import"./RemoveRowButton-DR_woDmL.js";import"./UseGenerator-CAKBBjbF.js";import"./OrderPartsWizard-C1qAvuat.js";import"./CompanyForms-9FjvHQe4.js";import"./PurchaseOrderForms-Bp86LBUe.js";function ge({parentId:p}){const s=Z("stocklocation"),d=N(),m=i.useMemo(()=>[{name:"cascade",label:t._({id:"VY386J"}),description:t._({id:"Ue7Vtx"})},{name:"structural",label:t._({id:"PRKZBP"}),description:t._({id:"zW8WBT"})},{name:"external",label:t._({id:"bVhrVt"}),description:t._({id:"ckSQBM"})},{name:"has_location_type",label:t._({id:"Sgyhpp"})},{name:"location_type",label:t._({id:"4sg5Qp"}),description:t._({id:"buIdz6"}),apiUrl:y(c.stock_location_type_list),model:n.stocklocationtype,modelRenderer:a=>a.name}],[]),S=i.useMemo(()=>[{accessor:"name",switchable:!1,render:a=>o.jsxs(B,{gap:"xs",children:[a.icon&&o.jsx(g,{name:a.icon}),a.name]})},je({}),{accessor:"pathstring",sortable:!0},{accessor:"items",sortable:!0},w({accessor:"structural",defaultVisible:!1}),w({accessor:"external",defaultVisible:!1}),{accessor:"location_type",sortable:!1,render:a=>{var r;return(r=a.location_type_detail)==null?void 0:r.name}}],[]),k=le({url:c.stock_location_list,title:t._({id:"sklcDg"}),fields:T(),focus:"name",initialData:{parent:p},follow:!0,modelType:n.stocklocation,table:s}),[e,b]=i.useState(-1),_=O({url:c.stock_location_list,pk:e,title:t._({id:"Qdjbg8"}),fields:T(),onFormSuccess:a=>s.updateRecord(a)}),f=re({url:c.stock_location_list,items:s.selectedIds,title:t._({id:"vqGtWs"}),fields:{parent:{}},onFormSuccess:s.refreshTable}),I=i.useMemo(()=>{const a=d.hasAddRole(u.stock_location),r=d.hasChangeRole(u.stock_location);return[o.jsx(H,{tooltip:t._({id:"Ego4rz"}),icon:o.jsx(A,{icon:"location"}),disabled:!s.hasSelectedRecords,actions:[{name:t._({id:"OORNPU"}),icon:o.jsx(A,{icon:"location"}),tooltip:t._({id:"dIzYVe"}),hidden:!r,disabled:!s.hasSelectedRecords,onClick:()=>{f.open()}}]}),o.jsx(de,{tooltip:t._({id:"sklcDg"}),onClick:()=>k.open(),hidden:!a},"add-stock-location")]},[d,s.hasSelectedRecords]),h=i.useCallback(a=>{const r=d.hasChangeRole(u.stock_location);return[$({hidden:!r,onClick:()=>{b(a.pk),_.open()}})]},[d]);return o.jsxs(o.Fragment,{children:[k.modal,_.modal,f.modal,o.jsx(ee,{url:y(c.stock_location_list),tableState:s,columns:S,props:{enableSelection:!0,enableDownload:!0,enableLabels:!0,enableReports:!0,params:{parent:p,top_level:p===void 0?!0:void 0},tableFilters:m,tableActions:I,rowActions:h,modelType:n.stocklocation}})]})}function st(){const{id:p}=K(),s=i.useMemo(()=>Number.isNaN(Number.parseInt(p||""))?void 0:p,[p]),d=X(),m=N(),[S,k]=i.useState(!1),{instance:e,refreshInstance:b,instanceQuery:_}=he({endpoint:c.stock_location_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),f=i.useMemo(()=>{if(s&&_.isFetching)return o.jsx(W,{});const l=[{type:"text",name:"name",label:t._({id:"6YtxFj"}),copy:!0,value_formatter:()=>o.jsxs(B,{gap:"xs",children:[e.icon&&o.jsx(g,{name:e.icon}),e.name]})},{type:"text",name:"pathstring",label:t._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:t._({id:"+o9hiJ"}),model:n.stocklocation,hidden:!(e!=null&&e.parent)}],x=[{type:"text",name:"items",icon:"stock",label:t._({id:"Jbck4N"}),value_formatter:()=>(e==null?void 0:e.items)||"0"},{type:"text",name:"sublocations",icon:"location",label:t._({id:"L7/8CO"}),hidden:!(e!=null&&e.sublocations)},{type:"boolean",name:"structural",label:t._({id:"PRKZBP"}),icon:"sitemap"},{type:"boolean",name:"external",label:t._({id:"bVhrVt"})},{type:"string",name:"location_type_detail.name",label:t._({id:"4sg5Qp"}),hidden:!(e!=null&&e.location_type),icon:"packages"}];return o.jsxs(ie,{children:[s&&(e!=null&&e.pk)?o.jsx(F,{item:e,fields:l}):o.jsx(z,{children:t._({id:"js9HzF"})}),s&&(e==null?void 0:e.pk)&&o.jsx(F,{item:e,fields:x})]})},[e,_]),I=i.useMemo(()=>[{name:"details",label:t._({id:"AC8C/Z"}),icon:o.jsx(q,{}),content:f},{name:"sublocations",label:t._({id:"1eBWAw"}),icon:o.jsx(G,{}),content:o.jsx(ge,{parentId:s})},{name:"stock-items",label:t._({id:"Jbck4N"}),icon:o.jsx(L,{}),content:o.jsx(fe,{tableName:"location-stock",allowAdd:!0,params:{location:s}})},{name:"default_parts",label:t._({id:"D19W4x"}),icon:o.jsx(L,{}),hidden:!e.pk,content:o.jsx(xe,{props:{params:{default_location:e.pk}}})}],[e,s]),h=O({url:c.stock_location_list,pk:s,title:t._({id:"Qdjbg8"}),fields:T(),onFormSuccess:b}),a=i.useMemo(()=>[{value:0,display_name:t._({id:"+oqXDN"})},{value:1,display_name:t._({id:"lzGbCT"})}],[]),r=pe({url:c.stock_location_list,pk:s,title:t._({id:"lnETLa"}),fields:{delete_stock_items:{label:t._({id:"j3pJx8"}),description:t._({id:"Ml7+Iv"}),field_type:"choice",choices:a},delete_sub_location:{label:t._({id:"+DlcAh"}),description:t._({id:"CEDjmR"}),field_type:"choice",choices:a}},onFormSuccess:()=>{e.parent?d(M(n.stocklocation,e.parent)):d("/stock/")}}),V=i.useMemo(()=>({pk:e.pk,model:"location",refresh:b,filters:{in_stock:!0}}),[e]),C=be({formProps:V,enabled:!0,delete:!1,merge:!1,assign:!1}),P=E({title:t._({id:"XaNm5l"}),modelType:n.stockitem,callback:async(l,x)=>{const j=x.stockitem.instance;return v.post(y(c.stock_transfer),{location:e.pk,items:[{pk:j.pk,quantity:j.quantity}]}).then(()=>({success:t._({id:"vdb1YW"})})).catch(D=>(console.error("Error scanning stock item:",D),{error:t._({id:"TL3ZFM"})}))}}),R=E({title:t._({id:"ohwQub"}),modelType:n.stocklocation,callback:async(l,x)=>{const j=x.stocklocation.pk;return v.patch(y(c.stock_location_list,j),{parent:e.pk}).then(()=>({success:t._({id:"1OrE7V"})})).catch(D=>(console.error("Error scanning stock location:",D),{error:t._({id:"nFD3+9"})}))}}),Q=i.useMemo(()=>[o.jsx(Y,{model:n.stocklocation,id:e.pk}),o.jsx(ke,{locationId:e.pk}),e.pk?o.jsx(te,{model:n.stocklocation,pk:e.pk,hash:e==null?void 0:e.barcode_hash,perm:m.hasChangeRole(u.stock_location),actions:[{name:"Scan in stock items",icon:o.jsx(A,{icon:"stock"}),tooltip:"Scan item into this location",onClick:P.open},{name:"Scan in container",icon:o.jsx(A,{icon:"unallocated_stock"}),tooltip:"Scan container into this location",onClick:R.open}]}):null,o.jsx(oe,{modelType:n.stocklocation,items:[e.pk??0],hidden:!(e!=null&&e.pk),enableLabels:!0,enableReports:!0}),C.dropdown,o.jsx(se,{tooltip:t._({id:"Ego4rz"}),actions:[ae({hidden:!s||!m.hasChangeRole(u.stock_location),tooltip:t._({id:"Qdjbg8"}),onClick:()=>h.open()}),ne({hidden:!s||!m.hasDeleteRole(u.stock_location),tooltip:t._({id:"lnETLa"}),onClick:()=>r.open()})]})],[e,s,m,C.dropdown]),U=i.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.path??[]).map(l=>({name:l.name,url:M(n.stocklocation,l.pk),icon:l.icon?o.jsx(g,{name:l.icon}):void 0}))],[e]);return o.jsxs(o.Fragment,{children:[h.modal,r.modal,P.dialog,R.dialog,o.jsxs(ce,{query:_,requiredRole:u.stock_location,children:[o.jsxs(J,{children:[o.jsx(me,{title:t._({id:"1eBWAw"}),modelType:n.stocklocation,endpoint:c.stock_location_tree,opened:S,onClose:()=>k(!1),selectedId:e==null?void 0:e.pk}),o.jsx(ue,{title:(e==null?void 0:e.name)??t._({id:"adXdas"}),subtitle:e==null?void 0:e.description,icon:(e==null?void 0:e.icon)&&o.jsx(g,{name:e==null?void 0:e.icon}),actions:Q,editAction:h.open,editEnabled:!!(e!=null&&e.pk)&&m.hasChangePermission(n.stocklocation),breadcrumbs:U,lastCrumb:[{name:e.name,url:`/stock/location/${e.pk}/`}],breadcrumbAction:()=>{k(!0)}}),o.jsx(_e,{pageKey:"stocklocation",panels:I,model:n.stocklocation,reloadInstance:b,id:e==null?void 0:e.pk,instance:e})]}),C.modals.map(l=>l.modal)]})]})}export{st as default};
//# sourceMappingURL=LocationDetail-CnVjNvu1.js.map
